{"version":3,"sources":["reducers/mainReducer.js","improve/react-avatar-editor/utils/load-image-url.js","improve/react-avatar-editor/index.js","improve/react-avatar-editor/utils/load-image-file.js","actions/appActions.js","components/Editor.js","components/Controls.js","components/EditorPlace.js","core/Container.js","core/DataManager.js","core/Control.js","configuration/Settings.js","core/helpers.js","App.js","serviceWorker.js","index.js"],"names":["mainReducerController","state","action","type","showHelp","currentHelp","addImagesSrc","concat","index","src","imagesTransform","imageChanged","r","rotation","s","scale","saveImages","target","resultImagesSrc","images","imagesSaved","data","loaded","showOpacity","mainReducer","extraAction","loadImageURL","imageURL","crossOrigin","Promise","resolve","reject","str","image","Image","onload","onerror","match","makeCancelable","promise","hasCanceled_","then","val","isCanceled","error","cancel","isTouchDevice","window","navigator","msMaxTouchPoints","isFileAPISupported","File","draggableEvents","touch","react","down","mouseDown","drag","move","mouseMove","up","mouseUp","native","desktop","deviceEvents","pixelRatio","devicePixelRatio","defaultEmptyImage","x","y","AvatarEditor","props","my","mx","handleImageReady","imageState","getInitialSize","width","height","resource","setState","onImageReady","onLoadSuccess","clearImage","canvas","getContext","clearRect","handleMouseDown","e","event","preventDefault","handleMouseUp","onMouseUp","getElementScale","element","eScale","style","transform","matrixRegex","matches","exec","Number","parentElement","handleMouseMove","containerref","current","mousePositionX","targetTouches","pageX","clientX","mousePositionY","pageY","clientY","newState","rotate","getCroppingRect","lastX","lastY","toRadians","degree","Math","PI","cos","sin","position","getXScale","getYScale","onPositionChange","onMouseMove","setCanvas","this","disableHiDPIScaling","context","loadImage","paint","document","thirdArgument","passiveSupported","options","Object","defineProperty","get","addEventListener","removeEventListener","err","isPassiveSupported","passive","nativeEvents","prevProps","prevState","paintImage","border","onImageChange","Array","isArray","getBorders","borderX","borderY","canvasWidth","canvasHeight","isVertical","cropRect","createElement","translate","drawImage","getDimensions","canvasAspect","imageAspect","min","croppingRect","xMin","xMax","yMin","yMax","disableBoundaryChecks","max","imageFile","loadingImage","reader","FileReader","result","readAsDataURL","catch","onLoadFailure","newHeight","newWidth","dimensions","scaleFactor","calculatePosition","save","globalCompositeOperation","restore","fillStyle","color","slice","join","borderRadius","borderSizeX","borderSizeY","beginPath","rect","widthMinusRad","heightMinusRad","arc","lineTo","drawRoundedRect","fill","rest","defaultStyle","cursor","touchAction","attributes","id","ref","React","Component","defaultProps","useImage","setStoreData","Editor","store","targetRefs","containerRefs","i","push","createRef","containerRef","loadButton_clickHandler","bind","unsubscribe","subscribe","onStoreChange","mounted","snapshot","getState","length","targetRef","getImageScaledToCanvas","toDataURL","mimeType","dispatch","substr","file","files","children","imageSrc","addImageTransform","addImagesTransform","imageTransform","key","className","addImagesRealSize","pointerEvents","editable","publishable","maskMargins","left","right","bottom","top","onChange","Controls","scaleRange_changeHandler","rotateRange_changeHandler","clearButton_clickHandler","scaleImage","value","rotateImage","addImagesDefaultSize","name","minScale","maxScale","step","minRotation","maxRotation","EditorPlace","editorRef","editorScale","editorX","editorY","publishSaveButton_clickHandler","themeButton_clickHandler","resetButton_clickHandler","mouseDownHandler","mouseUpHandler","updateBounds","clientWidth","clientHeight","lastWidth","lastHeight","editorBounds","bounds","setTimeout","republishInterval","publish","theme","loadedImageCount","backImageSrc","addImagesScale","mainImageSrc","opacity","display","onClick","onMouseDown","Container","sideMenu","topMenu","DataManager","isLoading","isLoaded","loader","reloadData","saveStorageData","localStorageManager","load","setStorageData","Control","actionMap","appStartDelay","app","onImage","onImages","dataForStorageChanged","loadTimeout","clearTimeout","stopTimeout","dataLoaded","loadDataError","reloadTimeout","settings","assetsUrl","localStoreName","isMobile","MobileDetect","userAgent","mobile","isLocal","test","location","toString","addImagesDefaultScale","Store","createStore","__REDUX_DEVTOOLS_EXTENSION__","App","initHandler","resizeHandler","windowInnerWidth","documentElement","body","innerWidth","windowInnerHeight","innerHeight","windowWidth","windowHeight","updateLayout","onInit","Boolean","hostname","getElementById","console","log","getAttribute","ReactDOM","render","StrictMode","serviceWorker","ready","registration","unregister","message"],"mappings":";sQAAIA,EAAwB,WAAyB,IAAxBC,EAAuB,uDAAf,GAAIC,EAAW,uCAGlD,OAAQA,EAAOC,MACb,IAAK,aACH,IAAIC,EAAWH,EAAMG,SAMrB,MAJyB,SAArBH,EAAMI,cACRD,GAAW,GAGN,2BACFH,GADL,IAEEI,YAAa,GACbD,aAIJ,IAAK,YACH,IAAIE,EAAeL,EAAMK,aAAaC,SACtCD,EAAaJ,EAAOM,OAASN,EAAOO,IAEpC,IAAIC,EAAkBT,EAAMS,gBAAgBH,SAG5C,OAAO,2BACFN,GADL,IAEEK,eACAI,kBACAC,cAAc,EACdN,YAAa,UAIjB,IAAK,eACH,IAAIK,EAAkBT,EAAMS,gBAAgBH,SAE5C,OADAG,EAAgBR,EAAOM,OAAOI,EAAIV,EAAOW,SAClC,2BACFZ,GADL,IAEES,oBAIJ,IAAK,cACH,IAAIA,EAAkBT,EAAMS,gBAAgBH,SAE5C,OADAG,EAAgBR,EAAOM,OAAOM,EAAIZ,EAAOa,MAClC,2BACFd,GADL,IAEES,oBAIJ,IAAK,cACH,IAAIJ,EAAeL,EAAMK,aAAaC,SAEtC,OADAD,EAAaJ,EAAOM,OAAS,KACtB,2BACFP,GADL,IAEEK,eACAK,cAAc,IAIlB,IAAK,cACH,OAAO,2BACFV,GADL,IAEEe,YAAY,EACZC,OAAQf,EAAOe,SAInB,IAAK,eACH,OAAO,2BACFhB,GADL,IAEEiB,gBAAiBhB,EAAOiB,OACxBH,YAAY,EACZI,aAAa,IAIjB,IAAK,WACH,OAAO,2BACFnB,GACAC,EAAOmB,MAId,IAAK,iBACH,OAAO,uCACFpB,GACAC,EAAOmB,MAFZ,IAGEC,QAAQ,IAIZ,IAAK,eACH,OAAO,2BACFrB,GADL,IAEEC,OAAQ,KACRS,cAAc,EACdS,aAAa,IAIjB,IAAK,eACH,IAAIV,EAAkB,CAAC,CAAEI,EAAG,EAAGF,EAAG,IAClC,OAAO,2BACFX,GADL,IAEES,oBAIJ,IAAK,oBACH,OAAO,2BACFT,GADL,IAEEsB,aAAa,IAIjB,IAAK,qBACH,OAAO,2BACFtB,GADL,IAEEsB,aAAa,IAIjB,QACE,OAAOtB,IAcEuB,EAVK,SAAdA,IAAuC,IAAxBvB,EAAuB,uDAAf,GAAIC,EAAW,uCAO1C,OANIA,EAAOuB,cACTxB,EAAQuB,EAAYvB,EAAOC,EAAOuB,cAGpCxB,EAAQD,EAAsBC,EAAOC,I,gBC7HxB,SAASwB,EAAaC,EAAUC,GAC7C,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3B,IAVeC,EAUTC,EAAQ,IAAIC,MAClBD,EAAME,OAAS,kBAAML,EAAQG,IAC7BA,EAAMG,QAAUL,GACY,KAZlB,QADKC,EAaDL,MARPK,EAAIK,MADC,mGASyBT,IACnCK,EAAML,YAAcA,GAEtBK,EAAMxB,IAAMkB,KCXhB,IAAMW,EAAiB,SAACC,GACtB,IAAIC,GAAe,EAWnB,MAAO,CACLD,QAVqB,IAAIV,SAAQ,SAACC,EAASC,GAE3CQ,EAAQE,MACN,SAACC,GAAD,OAAUF,EAAeT,EAAO,CAAEY,YAAY,IAAUb,EAAQY,MAChE,SAACE,GAAD,OAA2Bb,EAAfS,EAAsB,CAAEG,YAAY,GAAiBC,SAOnEC,OAFK,WAGHL,GAAe,KAKfM,IACc,qBAAXC,QACc,qBAAdC,aACN,iBAAkBD,QAAUC,UAAUC,iBAAmB,IAGtDC,EAAqC,qBAATC,KAoB5BC,EAAkB,CACtBC,MAAO,CACLC,MAAO,CACLC,KAAM,eACNC,UAAW,cACXC,KAAM,cACNC,KAAM,cACNC,UAAW,cACXC,GAAI,aACJC,QAAS,aAEXC,OAAQ,CACNP,KAAM,aACNC,UAAW,YACXC,KAAM,YACNC,KAAM,YACNC,UAAW,YACXC,GAAI,WACJC,QAAS,YAGbE,QAAS,CACPT,MAAO,CACLC,KAAM,cACNE,KAAM,aACNC,KAAM,cACNE,GAAI,aAENE,OAAQ,CACNP,KAAM,YACNE,KAAM,YACNC,KAAM,YACNE,GAAI,aAIJI,EAAelB,EACjBM,EAAgBC,MAChBD,EAAgBW,QAEhBE,EACgB,qBAAXlB,QAA0BA,OAAOmB,iBACpCnB,OAAOmB,iBACP,EA6CAC,EAAoB,CACxBC,EAAG,GACHC,EAAG,IAGCC,E,kDAuDJ,WAAYC,GAAQ,IAAD,8BACjB,cAAMA,IAIRtE,MAAQ,CACNwD,MAAM,EACNe,GAAI,KACJC,GAAI,KACJxC,MAAOkC,GATU,EAwRnBO,iBAAmB,SAACzC,GAClB,IAAM0C,EAAa,EAAKC,eAAe3C,EAAM4C,MAAO5C,EAAM6C,QAC1DH,EAAWI,SAAW9C,EACtB0C,EAAWP,EAAI,GACfO,EAAWN,EAAI,GACf,EAAKW,SAAS,CAAEvB,MAAM,EAAOxB,MAAO0C,GAAc,EAAKJ,MAAMU,cAC7D,EAAKV,MAAMW,cAAcP,IA9RR,EAuTnBQ,WAAa,WACK,EAAKC,OAAOC,WAAW,MAC/BC,UAAU,EAAG,EAAG,EAAKF,OAAOP,MAAO,EAAKO,OAAON,QACvD,EAAKE,SAAS,CACZ/C,MAAOkC,KA3TQ,EAmanBoB,gBAAkB,SAACC,IACjBA,EAAIA,GAAKzC,OAAO0C,OAIdC,iBACF,EAAKV,SAAS,CACZvB,MAAM,EACNgB,GAAI,KACJD,GAAI,QA5aW,EA+anBmB,cAAgB,WACV,EAAK1F,MAAMwD,OACb,EAAKuB,SAAS,CAAEvB,MAAM,IACtB,EAAKc,MAAMqB,cAlbI,EAsbnBC,gBAAkB,SAACC,EAAS/E,GAC1B,IAAIgF,EAAS,EACb,GAAID,EAAQE,MAAMC,UAAW,CAC3B,IAAIC,EACF,4GACEC,EAAUD,EAAYE,KAAKN,EAAQE,MAAMC,WACxCE,IAEHA,GADAD,EAAc,+BACQE,KAAKN,EAAQE,MAAMC,YAKzCF,EAHGI,EAGME,OAAOF,EAAQ,IAFf,EASb,OAJApF,GAAgBgF,EACZD,EAAQQ,gBACVvF,EAAQ,EAAK8E,gBAAgBC,EAAQQ,cAAevF,IAE/CA,GA1cU,EA6cnBwF,gBAAkB,SAACf,GAEjB,GADAA,EAAIA,GAAKzC,OAAO0C,OACQ,IAApB,EAAKxF,MAAMwD,KAAf,CAIA+B,EAAEE,iBAEF,IAAI3E,EAAQ,EAAI,EAAK8E,gBAAgB,EAAKtB,MAAMiC,aAAaC,QAAS,GAEhEC,GACHlB,EAAEmB,cAAgBnB,EAAEmB,cAAc,GAAGC,MAAQpB,EAAEqB,SAAW9F,EACvD+F,GACHtB,EAAEmB,cAAgBnB,EAAEmB,cAAc,GAAGI,MAAQvB,EAAEwB,SAAWjG,EAEvDkG,EAAW,CACfxC,GAAIiC,EACJlC,GAAIsC,GAGFI,EAAS,EAAK3C,MAAM2C,OAKxB,GAFAA,GADAA,GAAU,KACQ,EAAIA,EAAS,IAAMA,EAEjC,EAAKjH,MAAMwE,IAAM,EAAKxE,MAAMuE,GAAI,CAClC,IAAMC,EAAK,EAAKxE,MAAMwE,GAAKiC,EACrBlC,EAAK,EAAKvE,MAAMuE,GAAKsC,EAErBjC,EAAQ,EAAK5E,MAAMgC,MAAM4C,MAAQ,EAAKN,MAAMxD,MAC5C+D,EAAS,EAAK7E,MAAMgC,MAAM6C,OAAS,EAAKP,MAAMxD,MALlB,EAOL,EAAKoG,kBAAzBC,EAPyB,EAO5BhD,EAAaiD,EAPe,EAOlBhD,EAEhB+C,GAASvC,EACTwC,GAASvC,EAGT,IAAMwC,EAAY,SAACC,GAAD,OAAYA,GAAUC,KAAKC,GAAK,MAC5CC,EAAMF,KAAKE,IAAIJ,EAAUJ,IACzBS,EAAMH,KAAKG,IAAIL,EAAUJ,IAGzB7C,EAAIgD,GAAS5C,EAAKkD,EAAMnD,EAAKkD,EAK7BE,EAAW,CACfxD,GAPQgD,EAAQ3C,EAAKiD,EAAMlD,EAAKmD,GAOzB9C,EAJc,EAAI,EAAKN,MAAMxD,MAAS,EAAK8G,YAInB,EAC/BxD,EAAGA,EAAIS,EAJe,EAAI,EAAKP,MAAMxD,MAAS,EAAK+G,YAIlB,GAGnC,EAAKvD,MAAMwD,iBAAiBH,GAE5BX,EAAShF,MAAT,2BACK,EAAKhC,MAAMgC,OACX2F,GAIP,EAAK5C,SAASiC,GAEd,EAAK1C,MAAMyD,YAAYxC,KA5gBN,EA+gBnByC,UAAY,SAAC7C,GACX,EAAKA,OAASA,GA9gBd,EAAKA,OAAS,KAFG,E,gEAcb8C,KAAK3D,MAAM4D,sBACblE,EAAa,GAEf,IAAMmE,EAAUF,KAAK9C,OAAOC,WAAW,MAKvC,GAJI6C,KAAK3D,MAAMtC,OACbiG,KAAKG,UAAUH,KAAK3D,MAAMtC,OAE5BiG,KAAKI,MAAMF,GACPG,SAAU,CACZ,IACMC,IA9Le,WAEzB,IAAIC,GAAmB,EACvB,IACE,IAAMC,EAAUC,OAAOC,eAAe,GAAI,UAAW,CACnDC,IAAK,WACHJ,GAAmB,KAIvB1F,OAAO+F,iBAAiB,OAAQJ,EAASA,GACzC3F,OAAOgG,oBAAoB,OAAQL,EAASA,GAC5C,MAAOM,GACPP,GAAmB,EAErB,OAAOA,EA8KsBQ,IACgB,CAAEC,SAAS,GAE9CC,EAAenF,EAAaF,OAClCyE,SAASO,iBACPK,EAAazF,KACbwE,KAAK3B,gBACLiC,GAEFD,SAASO,iBACPK,EAAavF,GACbsE,KAAKvC,cACL6C,GAEE1F,IACFyF,SAASO,iBACPK,EAAaxF,UACbuE,KAAK3B,gBACLiC,GAEFD,SAASO,iBACPK,EAAatF,QACbqE,KAAKvC,cACL6C,O,yCAMWY,EAAWC,GAEzBnB,KAAK3D,MAAMtC,OAASiG,KAAK3D,MAAMtC,QAAUmH,EAAUnH,OACpDiG,KAAK3D,MAAMM,QAAUuE,EAAUvE,OAC/BqD,KAAK3D,MAAMO,SAAWsE,EAAUtE,OAEhCoD,KAAKG,UAAUH,KAAK3D,MAAMtC,OAChBiG,KAAK3D,MAAMtC,OAASoH,EAAUpH,QAAUkC,GAClD+D,KAAK/C,aAGP,IAAMiD,EAAUF,KAAK9C,OAAOC,WAAW,MACvC+C,EAAQ9C,UAAU,EAAG,EAAG4C,KAAK9C,OAAOP,MAAOqD,KAAK9C,OAAON,QACvDoD,KAAKI,MAAMF,GACXF,KAAKoB,WAAWlB,EAASF,KAAKjI,MAAMgC,MAAOiG,KAAK3D,MAAMgF,QAGpDH,EAAUnH,QAAUiG,KAAK3D,MAAMtC,OAC/BmH,EAAUvE,QAAUqD,KAAK3D,MAAMM,OAC/BuE,EAAUtE,SAAWoD,KAAK3D,MAAMO,QAChCsE,EAAUxB,WAAaM,KAAK3D,MAAMqD,UAClCwB,EAAUrI,QAAUmH,KAAK3D,MAAMxD,OAC/BqI,EAAUlC,SAAWgB,KAAK3D,MAAM2C,QAChCmC,EAAU7E,KAAO0D,KAAKjI,MAAMuE,IAC5B6E,EAAU5E,KAAOyD,KAAKjI,MAAMwE,IAC5B4E,EAAUpH,MAAMmC,IAAM8D,KAAKjI,MAAMgC,MAAMmC,GACvCiF,EAAUpH,MAAMoC,IAAM6D,KAAKjI,MAAMgC,MAAMoC,GAEvC6D,KAAK3D,MAAMiF,kB,6CAKb,GAAIjB,SAAU,CACZ,IAAMY,EAAenF,EAAaF,OAClCyE,SAASQ,oBACPI,EAAazF,KACbwE,KAAK3B,iBACL,GAEFgC,SAASQ,oBAAoBI,EAAavF,GAAIsE,KAAKvC,eAAe,GAC9D7C,IACFyF,SAASQ,oBACPI,EAAaxF,UACbuE,KAAK3B,iBACL,GAEFgC,SAASQ,oBACPI,EAAatF,QACbqE,KAAKvC,eACL,O,mCAQN,OAAOuC,KAAK3D,MAAM2C,OAAS,MAAQ,I,mCAGG,IAA7BqC,EAA4B,uDAAnBrB,KAAK3D,MAAMgF,OAC7B,OAAOE,MAAMC,QAAQH,GAAUA,EAAS,CAACA,EAAQA,K,sCAGlC,IAAD,EAC4BrB,KAAK3D,MAAvCM,EADM,EACNA,MAAOC,EADD,EACCA,OAAQoC,EADT,EACSA,OAAQqC,EADjB,EACiBA,OAEzBnE,EAAS,GAHD,EAKa8C,KAAKyB,WAAWJ,GAL7B,mBAKPK,EALO,KAKEC,EALF,KAORC,EAAcjF,EACdkF,EAAejF,EAarB,OAXIoD,KAAK8B,cACP5E,EAAOP,MAAQkF,EACf3E,EAAON,OAASgF,IAEhB1E,EAAOP,MAAQiF,EACf1E,EAAON,OAASiF,GAGlB3E,EAAOP,OAAmB,EAAV+E,EAChBxE,EAAON,QAAoB,EAAV+E,EAEV,CACLzE,SACA8B,SACArC,QACAC,SACAyE,Y,iCAMF,IAAMU,EAAW/B,KAAKf,kBAChBlF,EAAQiG,KAAKjI,MAAMgC,MAGzBgI,EAAS7F,GAAKnC,EAAM8C,SAASF,MAC7BoF,EAAS5F,GAAKpC,EAAM8C,SAASD,OAC7BmF,EAASpF,OAAS5C,EAAM8C,SAASF,MACjCoF,EAASnF,QAAU7C,EAAM8C,SAASD,OAGlC,IAAMM,EAASmD,SAAS2B,cAAc,UAElChC,KAAK8B,cACP5E,EAAOP,MAAQoF,EAASnF,OACxBM,EAAON,OAASmF,EAASpF,QAEzBO,EAAOP,MAAQoF,EAASpF,MACxBO,EAAON,OAASmF,EAASnF,QAK3B,IAAMsD,EAAUhD,EAAOC,WAAW,MAelC,OAbA+C,EAAQ+B,UAAU/E,EAAOP,MAAQ,EAAGO,EAAON,OAAS,GACpDsD,EAAQlB,OAAQgB,KAAK3D,MAAM2C,OAASM,KAAKC,GAAM,KAC/CW,EAAQ+B,WAAY/E,EAAOP,MAAQ,GAAMO,EAAON,OAAS,GAErDoD,KAAK8B,cACP5B,EAAQ+B,WACL/E,EAAOP,MAAQO,EAAON,QAAU,GAChCM,EAAON,OAASM,EAAOP,OAAS,GAIrCuD,EAAQgC,UAAUnI,EAAM8C,UAAWkF,EAAS7F,GAAI6F,EAAS5F,GAElDe,I,+CAOiB,IAAD,EACG8C,KAAKmC,gBAAvBxF,EADe,EACfA,MAAOC,EADQ,EACRA,OAETM,EAASmD,SAAS2B,cAAc,UAatC,OAXIhC,KAAK8B,cACP5E,EAAOP,MAAQC,EACfM,EAAON,OAASD,IAEhBO,EAAOP,MAAQA,EACfO,EAAON,OAASA,GAIlBoD,KAAKoB,WAAWlE,EAAOC,WAAW,MAAO6C,KAAKjI,MAAMgC,MAAO,EAAG,GAEvDmD,I,kCAIP,IAAMkF,EAAepC,KAAK3D,MAAMM,MAAQqD,KAAK3D,MAAMO,OAC7CyF,EAAcrC,KAAKjI,MAAMgC,MAAM4C,MAAQqD,KAAKjI,MAAMgC,MAAM6C,OAE9D,OAAO0C,KAAKgD,IAAI,EAAGF,EAAeC,K,kCAIlC,IAAMD,EAAepC,KAAK3D,MAAMO,OAASoD,KAAK3D,MAAMM,MAC9C0F,EAAcrC,KAAKjI,MAAMgC,MAAM6C,OAASoD,KAAKjI,MAAMgC,MAAM4C,MAE/D,OAAO2C,KAAKgD,IAAI,EAAGF,EAAeC,K,wCAIlC,IAAM3C,EAAWM,KAAK3D,MAAMqD,UAAY,CACtCxD,EAAG8D,KAAKjI,MAAMgC,MAAMmC,EACpBC,EAAG6D,KAAKjI,MAAMgC,MAAMoC,GAEhBQ,EAAS,EAAIqD,KAAK3D,MAAMxD,MAASmH,KAAKL,YACtC/C,EAAU,EAAIoD,KAAK3D,MAAMxD,MAASmH,KAAKJ,YAEvC2C,EAAe,CACnBrG,EAAGwD,EAASxD,EAAIS,EAAQ,EACxBR,EAAGuD,EAASvD,EAAIS,EAAS,EACzBD,QACAC,UAGE4F,EAAO,EACPC,EAAO,EAAIF,EAAa5F,MACxB+F,EAAO,EACPC,EAAO,EAAIJ,EAAa3F,OAe5B,OATEoD,KAAK3D,MAAMuG,uBAAyBjG,EAAQ,GAAKC,EAAS,KAG1D4F,GAAQD,EAAa5F,MACrB8F,EAAO,EACPC,GAAQH,EAAa3F,OACrB+F,EAAO,GAGF,2BACFJ,GADL,IAEErG,EAAGoD,KAAKuD,IAAIL,EAAMlD,KAAKgD,IAAIC,EAAarG,EAAGuG,IAC3CtG,EAAGmD,KAAKuD,IAAIH,EAAMpD,KAAKgD,IAAIC,EAAapG,EAAGwG,Q,gCAIrC5I,GChdG,IAAuB+I,EDid9B9H,GAAsBjB,aAAiBkB,KACzC+E,KAAK+C,aAAe3I,GCldY0I,EDkdiB/I,ECjd9C,IAAIJ,SAAQ,SAACC,EAASC,GAC3B,IAAMmJ,EAAS,IAAIC,WACnBD,EAAO/I,OAAS,SAAAqD,GACd,IACE,IAAMvD,EAAQP,EAAa8D,EAAEvE,OAAOmK,QACpCtJ,EAAQG,GACR,MAAOuD,GACPzD,EAAOyD,KAGX0F,EAAOG,cAAcL,QDwchBzI,QAAQE,KAAKyF,KAAKxD,kBAClB4G,MAAMpD,KAAK3D,MAAMgH,eACM,kBAAVtJ,IAChBiG,KAAK+C,aAAe3I,EAClBZ,EAAaO,EAAOiG,KAAK3D,MAAM3C,cAE9BW,QAAQE,KAAKyF,KAAKxD,kBAClB4G,MAAMpD,KAAK3D,MAAMgH,kB,qCAaT1G,EAAOC,GACpB,IAAI0G,EACAC,EAEEC,EAAaxD,KAAKmC,gBAYxB,OAXoBqB,EAAW5G,OAAS4G,EAAW7G,MAChCC,EAASD,EAI1B4G,EAAW5G,IADX2G,EAAYtD,KAAKmC,gBAAgBvF,QACDA,GAGhC0G,EAAY1G,IADZ2G,EAAWvD,KAAKmC,gBAAgBxF,OACCA,GAG5B,CACLC,OAAQ0G,EACR3G,MAAO4G,K,iCAYArD,EAASnG,EAAOsH,GAAmC,IAA3BoC,EAA0B,uDAAZ1H,EAC/C,GAAIhC,EAAM8C,SAAU,CAClB,IAAM6C,EAAWM,KAAK0D,kBAAkB3J,EAAOsH,GAE/CnB,EAAQyD,OAERzD,EAAQ+B,UAAU/B,EAAQhD,OAAOP,MAAQ,EAAGuD,EAAQhD,OAAON,OAAS,GACpEsD,EAAQlB,OAAQgB,KAAK3D,MAAM2C,OAASM,KAAKC,GAAM,KAC/CW,EAAQ+B,WACJ/B,EAAQhD,OAAOP,MAAQ,GACvBuD,EAAQhD,OAAON,OAAS,GAGxBoD,KAAK8B,cACP5B,EAAQ+B,WACL/B,EAAQhD,OAAOP,MAAQuD,EAAQhD,OAAON,QAAU,GAChDsD,EAAQhD,OAAON,OAASsD,EAAQhD,OAAOP,OAAS,GAIrDuD,EAAQrH,MAAM4K,EAAaA,GAE3BvD,EAAQ0D,yBAA2B,mBACnC1D,EAAQgC,UACNnI,EAAM8C,SACN6C,EAASxD,EACTwD,EAASvD,EACTuD,EAAS/C,MACT+C,EAAS9C,QAGXsD,EAAQ2D,a,wCAIM9J,EAAOsH,GACvBtH,EAAQA,GAASiG,KAAKjI,MAAMgC,MADG,MAGJiG,KAAKyB,WAAWJ,GAHZ,mBAGxBK,EAHwB,KAGfC,EAHe,KAKzBY,EAAevC,KAAKf,kBAEpBtC,EAAQ5C,EAAM4C,MAAQqD,KAAK3D,MAAMxD,MACjC+D,EAAS7C,EAAM6C,OAASoD,KAAK3D,MAAMxD,MAErCqD,GAAKqG,EAAarG,EAAIS,EACtBR,GAAKoG,EAAapG,EAAIS,EAU1B,OARIoD,KAAK8B,cACP5F,GAAKyF,EACLxF,GAAKuF,IAELxF,GAAKwF,EACLvF,GAAKwF,GAGA,CACLzF,IACAC,IACAS,SACAD,W,4BAIEuD,GACJA,EAAQyD,OACRzD,EAAQrH,MAAMkD,EAAYA,GAC1BmE,EAAQ+B,UAAU,EAAG,GACrB/B,EAAQ4D,UAAY,QAAU9D,KAAK3D,MAAM0H,MAAMC,MAAM,EAAG,GAAGC,KAAK,KAAO,IAEvE,IAAIC,EAAelE,KAAK3D,MAAM6H,aACxBV,EAAaxD,KAAKmC,gBAPX,EAQsBnC,KAAKyB,WAAW+B,EAAWnC,QARjD,mBAQN8C,EARM,KAQOC,EARP,KASPxH,EAAS4G,EAAWtG,OAAON,OAC3BD,EAAQ6G,EAAWtG,OAAOP,MAGhCuH,EAAe5E,KAAKuD,IAAIqB,EAAc,GACtCA,EAAe5E,KAAKgD,IAClB4B,EACAvH,EAAQ,EAAIwH,EACZvH,EAAS,EAAIwH,GAGflE,EAAQmE,YAzfY,SAACnE,EAAShE,EAAGC,EAAGQ,EAAOC,EAAQsH,GACrD,GAAqB,IAAjBA,EACFhE,EAAQoE,KAAKpI,EAAGC,EAAGQ,EAAOC,OACrB,CACL,IAAM2H,EAAgB5H,EAAQuH,EACxBM,EAAiB5H,EAASsH,EAChChE,EAAQ+B,UAAU/F,EAAGC,GACrB+D,EAAQuE,IACNP,EACAA,EACAA,EACA5E,KAAKC,GACK,IAAVD,KAAKC,IAEPW,EAAQwE,OAAOH,EAAe,GAC9BrE,EAAQuE,IACNF,EACAL,EACAA,EACU,IAAV5E,KAAKC,GACK,EAAVD,KAAKC,IAEPW,EAAQwE,OAAO/H,EAAO6H,GACtBtE,EAAQuE,IACNF,EACAC,EACAN,EACU,EAAV5E,KAAKC,GACK,GAAVD,KAAKC,IAEPW,EAAQwE,OAAOR,EAActH,GAC7BsD,EAAQuE,IACNP,EACAM,EACAN,EACU,GAAV5E,KAAKC,GACLD,KAAKC,IAEPW,EAAQ+B,WAAW/F,GAAIC,IAqdvBwI,CACEzE,EACAiE,EACAC,EACAzH,EAAsB,EAAdwH,EACRvH,EAAuB,EAAdwH,EACTF,GAEFhE,EAAQoE,KAAK3H,EAAO,GAAIA,EAAOC,GAC/BsD,EAAQ0E,KAAK,WAEb1E,EAAQ2D,Y,+BAmHA,IAAD,EAwBH7D,KAAK3D,MAZPyB,GAZK,EAELjF,MAFK,EAGLmG,OAHK,EAILjF,MAJK,EAKLsH,OALK,EAML6C,aANK,EAOLvH,MAPK,EAQLC,OARK,EASL8C,SATK,EAULqE,MAVK,EAYLjG,OAWG+G,GAvBE,EAaLnL,YAbK,EAcL2J,cAdK,EAeLrG,cAfK,EAgBLD,aAhBK,EAiBLuE,cAjBK,EAkBL5D,UAlBK,EAmBLoC,YAnBK,EAoBLD,iBApBK,EAqBL+C,sBArBK,EAsBL3C,oBAtBK,uRA0BDuD,EAAaxD,KAAKmC,gBAClB2C,EAAe,CACnBnI,MAAO6G,EAAWtG,OAAOP,MACzBC,OAAQ4G,EAAWtG,OAAON,OAC1BmI,OAAQ/E,KAAKjI,MAAMwD,KAAO,WAAa,OACvCyJ,YAAa,QAGTC,EAAa,CACjBtI,MAAO6G,EAAWtG,OAAOP,MAAQZ,EACjCa,OAAQ4G,EAAWtG,OAAON,OAASb,EACnC+B,MAAM,2BACDgH,GACAhH,IASP,OALAmH,EAAWnJ,EAAaV,MAAMC,MAAQ2E,KAAK3C,gBACvCzC,IACFqK,EAAWnJ,EAAaV,MAAME,WAAa0E,KAAK3C,iBAG3C,0CAAQ6H,GAAG,OAAOC,IAAKnF,KAAKD,WAAekF,EAAgBJ,Q,GA1nB3CO,IAAMC,WAA3BjJ,EAmCGkJ,aAAe,CACpBzM,MAAO,EACPmG,OAAQ,EACRqC,OAAQ,GACR6C,aAAc,EACdvH,MAAO,IACPC,OAAQ,IACRmH,MAAO,CAAC,EAAG,EAAG,EAAG,IACjBV,cARoB,aASpBrG,cAToB,aAUpBD,aAVoB,aAWpBuE,cAXoB,aAYpB5D,UAZoB,aAapBoC,YAboB,aAcpBD,iBAdoB,aAepB+C,uBAAuB,EACvB3C,qBAAqB,GA2kBV7D,I,EAAAA,IE1wBFmJ,EAAW,SAACjN,EAAOC,GAC9B,MAAO,CACLN,KAAM,YACNK,QACAC,QAuCSO,EAAa,SAACC,GACzB,MAAO,CACLd,KAAM,cACNc,OAAQA,IAoBCyM,EAAe,SAACrM,GAC3B,MAAO,CACLlB,KAAM,iBACNkB,KAAK,eACAA,KC+FMsM,E,kDArKb,WAAYpJ,GAAQ,IAAD,uBACjB,cAAMA,IAEDtE,MAAQ,GACb,EAAK2N,MAAQ,EAAKrJ,MAAMqJ,MAExB,EAAKC,WAAa,GAClB,EAAKC,cAAgB,GACrB,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IACrB,EAAKF,WAAWG,KAAKV,IAAMW,aAC3B,EAAKH,cAAcE,KAAKV,IAAMW,aAVf,OAajB,EAAKC,aAAeZ,IAAMW,YAC1B,EAAKhO,MAAQ,GACb,EAAKkO,wBAA0B,EAAKA,wBAAwBC,KAA7B,gBAfd,E,gEAkBE,IAAD,OAClBlG,KAAKmG,YAAcnG,KAAK0F,MAAMU,WAAU,WACtC,EAAKC,mBAEPrG,KAAKsG,SAAU,I,6CAIXtG,KAAKmG,aACPnG,KAAKmG,cAEPnG,KAAKsG,SAAU,I,yCAGEpF,EAAWC,EAAWoF,M,sCAGvC,GAAIvG,KAAKsG,QAAS,CAChB,IAAIvO,EAAQiI,KAAK0F,MAAMc,WAGvB,GAFAxG,KAAKlD,SAAS/E,GAEVA,EAAMe,WAAY,CAEpB,IADA,IAAIG,EAAS,GACJ4M,EAAI,EAAGA,EAAI7F,KAAK2F,WAAWc,OAAQZ,IAAK,CAC/C,IAAIa,EAAY1G,KAAK2F,WAAWE,GAC5Ba,EAAUnI,QACZtF,EAAO6M,KACLY,EAAUnI,QACPoI,yBACAC,UAAU5G,KAAKjI,MAAM8O,WAG1B5N,EAAO6M,KAAK,MAGhB9F,KAAK0F,MAAMoB,SDHQ,SAAC7N,GAC1B,MAAO,CACLhB,KAAM,eACNgB,UCAwBC,CAAYD,Q,8CAKdsE,GAAQ,IAAD,OACzBjF,EAAQ6F,OAAOZ,EAAMxE,OAAOmM,GAAG6B,OAAO,IACtCC,EAAOzJ,EAAMxE,OAAOkO,MAAM,GAC9B,GAAID,EAAM,CACR,IAAIhE,EAAS,IAAIC,WAEjBD,EAAO/I,QAIG+F,KAAK0F,MAHN,SAACpI,GACN,EAAKoI,MAAMoB,SAASvB,EAASjN,EAAOgF,EAAEvE,OAAOmK,WAGjDF,EAAOG,cAAc6D,M,+BAKvB,IAAIE,EAAW,GAGf,GAFAA,EAASpB,KAAK9F,KAAK3D,MAAM6K,UAErBlH,KAAKjI,MAAMK,aAEb,IADA,IACSyN,EAAI,EAAGA,EAAI7F,KAAKjI,MAAMK,aAAaqO,OAAQZ,IAAK,CACvD,IAAIsB,EAAWnH,KAAKjI,MAAMK,aAAayN,GACnCuB,EAAoBpH,KAAKjI,MAAMsP,mBAAmBxB,GAClDyB,EAAiBtH,KAAKjI,MAAMS,gBAAgBqN,GAG9CsB,GACa,KAAbA,GACAC,GACAE,EAEAJ,EAASpB,KACP,yBACEyB,IAAK,MAAQ1B,EACbX,GAAI,MAAQW,EACZ2B,UAAU,uBACVrC,IAAKnF,KAAK4F,cAAcC,GACxB/H,MAAO,CACLC,UAAU,UAAD,OAAYqJ,EAAZ,KACTzK,MAAOqD,KAAKjI,MAAM0P,kBAAkB9K,MACpCC,OAAQoD,KAAKjI,MAAM0P,kBAAkB7K,OACrC8K,cACE1H,KAAKjI,MAAM4P,UAAY3H,KAAKjI,MAAM6P,YAC9B,MACA,SAGR,yBACEL,IAAI,mBACJC,UAAU,mBACV1J,MAAOkC,KAAKjI,MAAM8P,aAElB,kBAAC,EAAD,CACE1C,IAAKnF,KAAK2F,WAAWE,GACrB9L,MAAOoN,EACP7I,aAAc0B,KAAK4F,cAAcC,GACjClJ,MACEqD,KAAKjI,MAAM0P,kBAAkB9K,MAC7BqD,KAAKjI,MAAM8P,YAAYC,KACvB9H,KAAKjI,MAAM8P,YAAYE,MAEzBnL,OACEoD,KAAKjI,MAAM0P,kBAAkB7K,OAC7BoD,KAAKjI,MAAM8P,YAAYG,OACvBhI,KAAKjI,MAAM8P,YAAYI,IAEzB5G,OAAQ,EACRxI,MAAOyO,EAAe1O,EACtBoG,OAAQsI,EAAe5O,OAM/BwO,EAASpB,KACP,yBACEZ,GAAI,MAAQW,EACZ0B,IAAK,MAAQ1B,EACb2B,UAAU,aACV1J,MAAO,CACLC,UAAU,UAAD,OAAYqJ,EAAZ,KACTzK,MAAOqD,KAAKjI,MAAM0P,kBAAkB9K,MACpCC,OAAQoD,KAAKjI,MAAM0P,kBAAkB7K,OACrC8K,cAAe1H,KAAKjI,MAAM4P,SAAW,MAAQ,SAG/C,2BACEzC,GAAI,MAAQW,EACZ5N,KAAK,OACLiQ,SAAUlI,KAAKiG,wBACfuB,UAAU,gBAQtB,OAAOpC,IAAMpD,cACX,MACA,CAAEkD,GAAI,SAAUpH,MAAOkC,KAAK3D,MAAMyB,MAAOqH,IAAKnF,KAAKgG,cACnDkB,O,GAjKe7B,aC6JN8C,E,kDA7Jb,WAAY9L,GAAQ,IAAD,uBACjB,cAAMA,IAEDtE,MAAQ,GACb,EAAK2N,MAAQ,EAAKrJ,MAAMqJ,MAExB,EAAKE,cAAgB,GACrB,IAAK,IAAIC,EAAI,EAAGA,EAAI,GAAIA,IACtB,EAAKD,cAAcE,KAAKV,IAAMW,aARf,OAWjB,EAAKC,aAAeZ,IAAMW,YAC1B,EAAKhO,MAAQ,GAEb,EAAKqQ,yBAA2B,EAAKA,yBAAyBlC,KAA9B,gBAChC,EAAKmC,0BAA4B,EAAKA,0BAA0BnC,KAA/B,gBACjC,EAAKoC,yBAA2B,EAAKA,yBAAyBpC,KAA9B,gBAhBf,E,gEAmBE,IAAD,OAClBlG,KAAKmG,YAAcnG,KAAK0F,MAAMU,WAAU,WACtC,EAAKC,mBAEPrG,KAAKsG,SAAU,I,6CAIXtG,KAAKmG,aACPnG,KAAKmG,cAEPnG,KAAKsG,SAAU,I,yCAGEpF,EAAWC,EAAWoF,M,sCAGvC,GAAIvG,KAAKsG,QAAS,CAChB,IAAIvO,EAAQiI,KAAK0F,MAAMc,WACvBxG,KAAKlD,SAAS/E,M,+CAIOwF,GACvB,IAAIjF,EAAQ6F,OAAOZ,EAAMxE,OAAOmM,GAAG6B,OAAO,IAC1C/G,KAAK0F,MAAMoB,SFpBW,SAACxO,EAAOO,GAChC,MAAO,CACLZ,KAAM,cACNK,QACAO,SEgBoB0P,CAAWjQ,EAAOiF,EAAMxE,OAAOyP,U,gDAG3BjL,GACxB,IAAIjF,EAAQ6F,OAAOZ,EAAMxE,OAAOmM,GAAG6B,OAAO,IAC1C/G,KAAK0F,MAAMoB,SFjCY,SAACxO,EAAOK,GACjC,MAAO,CACLV,KAAM,eACNK,QACAK,YE6BoB8P,CAAYnQ,EAAOiF,EAAMxE,OAAOyP,U,+CAG7BjL,GACvB,IAAIjF,EAAQ6F,OAAOZ,EAAMxE,OAAOmM,GAAG6B,OAAO,IAC1C/G,KAAK0F,MAAMoB,SF7CW,SAACxO,GACzB,MAAO,CACLL,KAAM,cACNK,SE0CoB2E,CAAW3E,EAAOiF,EAAMxE,OAAOyP,U,+BAInD,IAAItB,EAAW,GAGf,GAFAA,EAASpB,KAAK9F,KAAK3D,MAAM6K,UAErBlH,KAAKjI,MAAMK,aAEb,IADA,IACSyN,EAAI,EAAGA,EAAI7F,KAAKjI,MAAMK,aAAaqO,OAAQZ,IAAK,CACvD,IAAIsB,EAAWnH,KAAKjI,MAAMK,aAAayN,GACnCuB,EAAoBpH,KAAKjI,MAAMsP,mBAAmBxB,GAClDyB,EAAiBtH,KAAKjI,MAAMS,gBAAgBqN,GAG9CsB,GACa,KAAbA,GACAC,GACAE,GAEAJ,EAASpB,KACP,yBACEyB,IAAK,MAAQ1B,EACbX,GAAI,MAAQW,EACZ2B,UAAU,oBACVrC,IAAKnF,KAAK4F,cAAcC,GACxB/H,MAAO,CACLC,UAAU,UAAD,OAAYqJ,EAAZ,KACTzK,MAAOqD,KAAKjI,MAAM2Q,qBAAqB/L,MACvCC,OAAQoD,KAAKjI,MAAM2Q,qBAAqB9L,SAG1C,2BACE3E,KAAK,QACLiN,GAAI,MAAQW,EACZ8C,KAAM,MAAQ9C,EACdvD,IAAKtC,KAAKjI,MAAM6Q,SAChB/F,IAAK7C,KAAKjI,MAAM8Q,SAChBC,KAAK,OACLN,MAAOlB,EAAe1O,EACtB4O,UAAU,aACVU,SAAUlI,KAAKoI,2BAEjB,2BACEnQ,KAAK,QACLiN,GAAI,MAAQW,EACZ8C,KAAM,MAAQ9C,EACdvD,IAAKtC,KAAKjI,MAAMgR,YAChBlG,IAAK7C,KAAKjI,MAAMiR,YAChBF,KAAK,IACLN,MAAOlB,EAAe5O,EACtB8O,UAAU,cACVU,SAAUlI,KAAKqI,8BA2C3B,OAAOjD,IAAMpD,cACX,MACA,CAAEkD,GAAI,WAAYpH,MAAOkC,KAAK3D,MAAMyB,MAAOqH,IAAKnF,KAAKgG,cACrDkB,O,GAzJiB7B,aCkVR4D,E,kDAvUb,WAAY5M,GAAQ,IAAD,8BACjB,cAAMA,IACDqJ,MAAQ,EAAKrJ,MAAMqJ,MAExB,EAAKP,IAAMC,IAAMW,YACjB,EAAKC,aAAeZ,IAAMW,YAC1B,EAAKmD,UAAY9D,IAAMW,YAEvB,EAAKhO,MAAQ,CACXoR,YAAa,IACbC,QAAS,EACTC,QAAS,GAGX,EAAKpD,wBAA0B,EAAKA,wBAAwBC,KAA7B,gBAE/B,EAAKoD,+BACH,EAAKA,+BAA+BpD,KAApC,gBAEF,EAAKqD,yBAA2B,EAAKA,yBAAyBrD,KAA9B,gBAChC,EAAKsD,yBAA2B,EAAKA,yBAAyBtD,KAA9B,gBAEhC,EAAKuD,iBAAmB,EAAKA,iBAAiBvD,KAAtB,gBACxB,EAAKwD,eAAiB,EAAKA,eAAexD,KAApB,gBAvBL,E,gEA0BE,IAAD,OAClBlG,KAAKmG,YAAcnG,KAAK0F,MAAMU,WAAU,WACtC,EAAKC,mBAEPrG,KAAKsG,SAAU,I,6CAIXtG,KAAKmG,aACPnG,KAAKmG,cAEPnG,KAAKsG,SAAU,I,yCAGEpF,EAAWC,EAAWoF,GACvCvG,KAAK2J,aACH3J,KAAKmF,IAAI5G,QAAQqL,YACjB5J,KAAKmF,IAAI5G,QAAQsL,gB,sCAKnB,GAAI7J,KAAKsG,QAAS,CAChB,IAAIvO,EAAQiI,KAAK0F,MAAMc,WACvBxG,KAAKlD,SAAL,2BACKkD,KAAKjI,OACLA,O,mCAKI4E,EAAOC,GAClB,IAAIoD,KAAK8J,YAAcnN,GAASqD,KAAK+J,aAAenN,IAC9CoD,KAAKjI,MAAMiS,aAAc,CAC3BhK,KAAK8J,UAAYnN,EACjBqD,KAAK+J,WAAanN,EAClB,IAAIqN,EAASjK,KAAKjI,MAAMiS,aACpBb,EAAc7J,KAAKgD,IACrB3F,EAAQsN,EAAOtN,MACfC,EAASqN,EAAOrN,QAEdwM,GAAWzM,EAAQsN,EAAOtN,MAAQwM,GAAe,EAAIA,EACrDE,GAAWzM,EAASqN,EAAOrN,OAASuM,GAAe,EAAIA,EAC3DnJ,KAAKlD,SAAL,2BACKkD,KAAKjI,OADV,IAEEoR,cACAC,UACAC,gB,8BAMAtQ,GAAS,IAAD,OACdiH,KAAK0F,MAAMoB,SAAStB,EAAa,CAAEoC,aAAa,KAChDsC,YAAW,WACT,EAAKxE,MAAMoB,SAAStB,EAAa,CAAEoC,aAAa,OAC/C5H,KAAKjI,MAAMoS,mBACdnK,KAAK0F,MAAMoB,SAAShO,EAAWC,M,8CAGTwE,GAAQ,IAAD,OACzBjF,EAAQ6F,OAAOZ,EAAMxE,OAAOmM,GAAG6B,OAAO,IACtCC,EAAOzJ,EAAMxE,OAAOkO,MAAM,GAC9B,GAAID,EAAM,CACR,IAAIhE,EAAS,IAAIC,WAEjBD,EAAO/I,QAIG+F,KAAK0F,MAHN,SAACpI,GACN,EAAKoI,MAAMoB,SAASvB,EAASjN,EAAOgF,EAAEvE,OAAOmK,WAGjDF,EAAOG,cAAc6D,M,qDAIMzJ,GAC7ByC,KAAKoK,QAAQ,U,+CAGU7M,GACC,QAApByC,KAAKjI,MAAMsS,MACbrK,KAAK0F,MAAMoB,SAAStB,EAAa,CAAE6E,MAAO,WAE1CrK,KAAK0F,MAAMoB,SAAStB,EAAa,CAAE6E,MAAO,Y,+CAIrB9M,GACvByC,KAAK0F,MAAMoB,SHtFN,CACL7O,KAAM,mB,uCGwFSsF,GACfyC,KAAK0F,MAAMoB,SHrIN,CACL7O,KAAM,eGqIN,IAAIc,EAASwE,EAAMxE,OAASwE,EAAMxE,OAAOmM,GAAK,GAC/B,SAAXnM,GAAgC,SAAXA,GAAgC,SAAXA,GAC5CiH,KAAK0F,MAAMoB,SHUR,CACL7O,KAAM,wB,uCGNF+H,KAAKjI,MAAMsB,aAAa2G,KAAK0F,MAAMoB,SHWlC,CACL7O,KAAM,yB,+BGRN,IAAIiP,EAAW,GACfA,EAASpB,KAAK9F,KAAK3D,MAAM6K,UAGzB,GAAIlH,KAAKjI,MAAMK,aACb,IAAK,IAAIyN,EAAI,EAAGA,EAAI7F,KAAKjI,MAAMK,aAAaqO,OAAQZ,IAC9C7F,KAAKjI,MAAMK,aAAayN,IAAoC,IAA9B7F,KAAKjI,MAAMK,aAAayN,IACxDyE,EAKN,IAAInD,EAAWnH,KAAKjI,MAAMK,aAAe4H,KAAKjI,MAAMK,aAAa,GAAK,KAElEgP,EAAoBpH,KAAKjI,MAAMsP,mBAC/BrH,KAAKjI,MAAMsP,mBAAmB,GAC9B,KACAC,EAAiBtH,KAAKjI,MAAMS,gBAC5BwH,KAAKjI,MAAMS,gBAAgB,GAC3B,KAmKJ,OAjKA0O,EAASpB,KACP,yBACEZ,GAAG,kBACHqC,IAAI,kBACJpC,IAAKnF,KAAKgG,aACVlI,MAAO,CACLnB,MAAOqD,KAAKjI,MAAMiS,aAAehK,KAAKjI,MAAMiS,aAAarN,MAAQ,EACjEC,OAAQoD,KAAKjI,MAAMiS,aAAehK,KAAKjI,MAAMiS,aAAapN,OAAS,EACnEmB,UAAU,SAAD,OAAWiC,KAAKjI,MAAMoR,YAAtB,wBAAiDnJ,KAAKjI,MAAMqR,QAA5D,0BAAqFpJ,KAAKjI,MAAMsR,QAAhG,SAGX,yBAAKnE,GAAG,cAAcqC,IAAI,eACxB,yBAAKhP,IAAI,eAEX,yBAAK2M,GAAG,cAAcqC,IAAI,eACxB,yBACErC,GAAG,YACHqC,IAAI,YACJzJ,MAAO,CACLnB,MAAOqD,KAAKjI,MAAM2Q,qBACd1I,KAAKjI,MAAM2Q,qBAAqB/L,MAChC,EACJC,OAAQoD,KAAKjI,MAAM2Q,qBACf1I,KAAKjI,MAAM2Q,qBAAqB9L,OAChC,GAENrE,IACEyH,KAAKjI,MAAMwS,aACPvK,KAAKjI,MAAMwS,aAAavK,KAAKjI,MAAMsS,OACnC,KAGR,kBAAC,EAAD,CACEnF,GAAG,SACHqC,IAAI,SACJ1O,MAAOmH,KAAKjI,MAAMoR,YAClBzD,MAAO1F,KAAK3D,MAAMqJ,MAClBP,IAAKnF,KAAKkJ,UACVpL,MAAO,CACLnB,MAAOqD,KAAKjI,MAAM0P,kBACdzH,KAAKjI,MAAM0P,kBAAkB9K,MAC7B,EACJC,OAAQoD,KAAKjI,MAAM0P,kBACfzH,KAAKjI,MAAM0P,kBAAkB7K,OAC7B,EACJmB,UAAU,UAAD,OAAYiC,KAAKjI,MAAMyS,eAAvB,mBACPxK,KAAKjI,MAAMyS,eADJ,aAGPxK,KAAKjI,MAAM0P,mBACNzH,KAAKjI,MAAM0P,kBAAkB9K,MAAQ,EACtC,EALG,aAOPqD,KAAKjI,MAAM0P,mBACNzH,KAAKjI,MAAM0P,kBAAkB7K,OAAS,EACvC,EATG,QAab,yBACEsI,GAAG,YACHqC,IAAI,YACJhP,IACEyH,KAAKjI,MAAM0S,aACPzK,KAAKjI,MAAM0S,aAAazK,KAAKjI,MAAMsS,OACnC,GAENvM,MAAO,CACL4M,QAAS1K,KAAKjI,MAAM4P,UAAY3H,KAAKjI,MAAMsB,YAAc,GAAM,EAC/DsD,MAAOqD,KAAKjI,MAAM2Q,qBACd1I,KAAKjI,MAAM2Q,qBAAqB/L,MAChC,EACJC,OAAQoD,KAAKjI,MAAM2Q,qBACf1I,KAAKjI,MAAM2Q,qBAAqB9L,OAChC,KAGR,kBAAC,EAAD,CACEsI,GAAG,WACHqC,IAAI,WACJ1O,MAAOmH,KAAKjI,MAAMoR,YAClBzD,MAAO1F,KAAK3D,MAAMqJ,MAClBP,IAAKnF,KAAKkJ,UACVpL,MAAO,CACL6M,QACE3K,KAAKjI,MAAM4P,UAAY3H,KAAKjI,MAAM6P,YAC9B,QACA,OACNjL,MAAOqD,KAAKjI,MAAM2Q,qBACd1I,KAAKjI,MAAM2Q,qBAAqB/L,MAChC,EACJC,OAAQoD,KAAKjI,MAAM2Q,qBACf1I,KAAKjI,MAAM2Q,qBAAqB9L,OAChC,KAGR,yBACEsI,GAAG,aACHqC,IAAI,aACJC,UAAWL,GAAyB,KAAbA,EAAkB,UAAY,OACrDrJ,MAAO,CACL4J,cACE1H,KAAKjI,MAAM4P,UAAY3H,KAAKjI,MAAM6P,YAAc,MAAQ,SAG5D,2BACE1C,GAAG,OACHjN,KAAK,OACLiQ,SAAUlI,KAAKiG,wBACfuB,UAAU,eAGd,yBACEtC,GAAG,aACHqC,IAAI,aACJC,UACE,iBACCxH,KAAKjI,MAAM6P,aACZ5H,KAAKjI,MAAM4P,UACXR,GACa,KAAbA,GACAC,GACAE,EACI,cACA,iBAENsD,QAAS5K,KAAKsJ,iCAEhB,yBACEpE,GAAG,cACHqC,IAAI,cACJC,UAAW,SAAWxH,KAAKjI,MAAMsS,MACjCO,QAAS5K,KAAKuJ,yBACdzL,MAAO,CACL4J,cACE1H,KAAKjI,MAAM4P,UAAY3H,KAAKjI,MAAM6P,YAAc,MAAQ,UAI9D,yBACE1C,GAAG,cACHqC,IAAI,cACJqD,QAAS5K,KAAKwJ,yBACd1L,MAAO,CACL4J,cACE1H,KAAKjI,MAAM4P,UAAY3H,KAAKjI,MAAM6P,YAAc,MAAQ,OAE1D+C,QACE3K,KAAKjI,MAAM6P,aACX5H,KAAKjI,MAAM4P,UACXR,GACa,KAAbA,GACAC,GACAE,EACI,QACA,aAOTlC,IAAMpD,cACX,MACA,CACEkD,GAAI,cACJpH,MAAOkC,KAAK3D,MAAMyB,MAClBqH,IAAKnF,KAAKmF,IACV0F,YAAa7K,KAAKyJ,iBAClB/L,UAAWsC,KAAK0J,gBAElBxC,O,GAnUoB7B,aCuCXyF,E,kDAhDb,WAAYzO,GAAQ,IAAD,8BACjB,cAAMA,IACDtE,MAAQ,GACb,EAAK2N,MAAQ,EAAKrJ,MAAMqJ,MAHP,E,gEAME,IAAD,OAClB1F,KAAKmG,YAAcnG,KAAK0F,MAAMU,WAAU,WACtC,EAAKC,mBAEPrG,KAAKsG,SAAU,I,6CAIXtG,KAAKmG,aACPnG,KAAKmG,cAEPnG,KAAKsG,SAAU,I,yCAGEpF,EAAWC,EAAWoF,M,sCAGvC,GAAIvG,KAAKsG,QAAS,CAChB,IAAIvO,EAAQiI,KAAK0F,MAAMc,WACvBxG,KAAKlD,SAAS/E,M,+BAKhB,IAAImP,EAAW,GAcf,OAbAA,EAASpB,KAAK9F,KAAK3D,MAAM6K,UAEzBA,EAASpB,KACP,kBAAC,EAAD,CACEJ,MAAO1F,KAAK0F,MACZ6B,IAAI,cACJzJ,MAAO,CACLiK,MAAO/H,KAAKjI,MAAMgT,SAAW/K,KAAKjI,MAAMgT,SAASpO,MAAQ,EACzDsL,IAAKjI,KAAKjI,MAAMiT,QAAUhL,KAAKjI,MAAMiT,QAAQpO,OAAS,MAKrDwI,IAAMpD,cAAc,MAAO,CAAEkD,GAAI,aAAegC,O,GA7CnC7B,aCyET4F,E,kDArEb,WAAY5O,GAAQ,IAAD,8BACjB,cAAMA,IACDqJ,MAAQ,EAAKrJ,MAAMqJ,MACxB,EAAK3N,MAAQ,CACXmT,WAAU,EACVC,UAAS,GAEX,EAAKC,OAAO,KACZ,EAAKlI,OAAO,KARK,E,gEAcE,IAAD,OAClBlD,KAAKmG,YAAYnG,KAAK0F,MAAMU,WAAU,WAAK,EAAKC,mBAEhDrG,KAAKsG,SAAQ,I,6CAITtG,KAAKmG,aACPnG,KAAKmG,cAEPnG,KAAKsG,SAAQ,I,yCAGIpF,EAAWC,M,sCAI5B,GAAInB,KAAKsG,QAAS,CAChB,IAAIvO,EAAMiI,KAAK0F,MAAMc,WAEjBzO,EAAMsT,YAINtT,EAAMuT,iBAERtL,KAAKsL,qB,wCAOT,IAAInS,EAAK6G,KAAKuL,oBAAoBC,OAClCxL,KAAK0F,MAAMoB,SLgEe,SAAC3N,GAC7B,MAAO,CACLlB,KAAM,mBACNkB,QKlEEsS,CAAetS,M,wCAOjB6G,KAAKuL,oBAAoB5H,KAAK,IAG9B3D,KAAK0F,MAAMoB,SLuEN,CACL7O,KAAM,qBACNkB,KAAM,CACJmS,iBAAiB,O,+BKpEnB,OAAO,S,GAnEejG,aCmIXqG,E,kDAzHb,WAAYrP,GAAQ,IAAD,8BACjB,cAAMA,IACDtE,MAAQ,GACb,EAAK2N,MAAQ,EAAKrJ,MAAMqJ,MAExB,EAAKiG,UAAU,GAGf,EAAKC,cAAc,IARF,E,gEAqBE,IAAD,OAClB5L,KAAKmG,YAAYnG,KAAK0F,MAAMU,WAAU,WAAK,EAAKC,mBAChDrG,KAAKsG,SAAQ,I,6CAITtG,KAAKmG,aACPnG,KAAKmG,cAEPnG,KAAKsG,SAAQ,I,sCAUb,GAAItG,KAAKsG,QAAS,CAEhB,IAAIvO,EAAMiI,KAAK0F,MAAMc,WAIjBzO,EAAMU,eACNuH,KAAK3D,MAAMwP,IAAIxP,MAAMyP,QAAQ9L,KAAK3D,MAAMwP,KACxC7L,KAAK0F,MAAMoB,SN1BZ,CACL7O,KAAM,kBM8BAF,EAAMmB,cACN8G,KAAK3D,MAAMwP,IAAIxP,MAAM0P,SAAS/L,KAAK3D,MAAMwP,IAAI9T,EAAMiB,gBAAgBjB,EAAMgB,QACzEiH,KAAK0F,MAAMoB,SNjCZ,CACL7O,KAAM,kBM6DAF,EAAMiU,uBAERhM,KAAK0F,MAAMoB,SN0BV,CACL7O,KAAM,oBACNkB,KAAM,CACJmS,iBAAiB,EACjBU,sBAAuB,W,oCMtBrBhM,KAAKiM,cACPC,aAAalM,KAAKiM,aAClBjM,KAAKiM,YAAY,Q,sCAIJ,IAAD,OAEdjM,KAAKmM,cAELnM,KAAKiM,YAAY/B,YAAW,WAE1B,EAAKxE,MAAMoB,SN5BR,CACL7O,KAAM,oBACNkB,KAAM,CACJiT,YAAY,EACZf,YAAY,EACZgB,eAAe,OM0BfrM,KAAK0F,MAAM4G,iB,+BAOb,OAAO,S,GA5HWjH,a,uCC0DPkH,G,MAhED,GACZC,UAAW,IACXC,eAAgB,kBAEhBC,SCEmB,IAAIC,IAAa9R,OAAOC,UAAU8R,WACjCC,SDFpBC,SCMS,KAAKC,KAAK1M,SAAS2M,SAASC,YDJrCjD,aAAc,CACZrN,MAAO,EACPC,OAAQ,GAGV8L,qBAAsB,CACpB/L,MAAO,IACPC,OAAQ,KAGV6K,kBAAmB,CACjB9K,MAAO,IACPC,OAAQ,KAGV4N,eAAgB,EAEhB3C,YAAa,CACXC,KAAM,EACNC,MAAO,EACPC,OAAQ,EACRC,IAAK,GAGPiF,sBAAuB,GAEvBzC,aAAc,GACdrS,aAAc,CAAC,IACfiP,mBAAoB,CAAC,MAErBrO,gBAAiB,CAAC,KArCN,6BAuCE,IAvCF,6BAwCE,IAxCF,8BA0CG,IA1CH,8BA2CG,IA3CH,4BA6CC,SA7CD,0BA8CF,GA9CE,yBAgDF,GAhDE,yBAiDF,IAjDE,4BAmDC,GAnDD,4BAoDC,KApDD,gCAsDK,CAAC,CAAEJ,EAAG,EAAGF,EAAG,KAtDjB,0BAwDF,GAxDE,6BAyDC,GAzDD,kCA2DO,KA3DP,sBA4DL,QA5DK,6BA6DC,GA7DD,GEeRyU,G,MAAQC,YACZ9T,EACAuB,OAAOwS,8BAAgCxS,OAAOwS,iCA6FjCC,E,kDAxFb,WAAYjR,GAAQ,IAAD,8BACjB,cAAMA,IAEDtE,MAAQ,GAEb,EAAKwV,YAAY,EAAKA,YAAYrH,KAAjB,gBACjB,EAAKsH,cAAc,EAAKA,cAActH,KAAnB,gBANF,E,2DAUjB,IAAIuH,EAAiBpN,SAASqN,gBAAgB9D,aAAevJ,SAASsN,KAAK/D,aAAe/O,OAAO+S,WAC7FC,EAAkBxN,SAASqN,gBAAgB7D,cAAgBxJ,SAASsN,KAAK9D,cAAgBhP,OAAOiT,YAEpG9N,KAAKlD,SAAL,2BACKkD,KAAKjI,OADV,IAEEgW,YAAYN,EACZO,aAAaH,O,kCAKLtQ,GACVyC,KAAKiO,iB,oCAGO1Q,GACZyC,KAAKiO,iB,8BAGC9U,GACNgU,EAAMrG,SACJtB,EAAarM,M,8BAITA,GACN,OAAOgU,EAAM3G,a,mCAIb2G,EAAMrG,SACJhO,O,yCAIeoI,EAAWC,EAAWoF,M,0CTNpB,IAACpN,ESUpBgU,EAAMrG,UTVc3N,ESWVoT,ETVL,CACLtU,KAAM,WACNkB,KAAK,eACAA,MSUL0B,OAAO+F,iBAAiB,OAAOZ,KAAKuN,aACpC1S,OAAO+F,iBAAiB,SAASZ,KAAKwN,eAOtCxN,KAAK3D,MAAM6R,OAAOlO,Q,+BAKlB,OACE,kBAAC,IAAD,CAAU0F,MAAOyH,GACf,kBAAC,EAAD,CACEjI,GAAG,YACH6I,YAAa/N,KAAKjI,MAAMgW,YACxBC,aAAchO,KAAKjI,MAAMiW,aACzBtI,MAAOyH,GAEP,kBAAC,EAAD,CACEzH,MAAOyH,IAET,kBAAC,EAAD,CACEtB,IAAK7L,KACL0F,MAAOyH,U,GAjFD9H,aCVE8I,QACW,cAA7BtT,OAAOmS,SAASoB,UAEe,UAA7BvT,OAAOmS,SAASoB,UAEhBvT,OAAOmS,SAASoB,SAASjU,MACvB,2DCZN,IAAIyD,EAAQyC,SAASgO,eAAe,gBAEpCC,QAAQC,IAAI3Q,EAAQ4Q,aAAa,WAEjCC,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,CACEzJ,GAAG,YACHgJ,OAAQrT,OAAO+C,EAAQ4Q,aAAa,WACpC1C,QAASjR,OAAO+C,EAAQ4Q,aAAa,YACrCzC,SAAUlR,OAAO+C,EAAQ4Q,aAAa,gBAG1C5Q,GDgHI,kBAAmB9C,WACrBA,UAAU8T,cAAcC,MACrBtU,MAAK,SAAAuU,GACJA,EAAaC,gBAEd3L,OAAM,SAAA1I,GACL4T,QAAQ5T,MAAMA,EAAMsU,c","file":"static/js/main.0ea0ce31.chunk.js","sourcesContent":["let mainReducerController = (state = {}, action) => {\r\n  // console.log(\"mainReducer\",action);\r\n\r\n  switch (action.type) {\r\n    case \"CLEAR_HELP\": {\r\n      let showHelp = state.showHelp;\r\n\r\n      if (state.currentHelp == \"help2\") {\r\n        showHelp = false;\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        currentHelp: \"\",\r\n        showHelp,\r\n      };\r\n    }\r\n\r\n    case \"USE_IMAGE\": {\r\n      let addImagesSrc = state.addImagesSrc.concat();\r\n      addImagesSrc[action.index] = action.src;\r\n\r\n      let imagesTransform = state.imagesTransform.concat();\r\n      // imagesTransform[action.index].s=2;\r\n\r\n      return {\r\n        ...state,\r\n        addImagesSrc,\r\n        imagesTransform,\r\n        imageChanged: true,\r\n        currentHelp: \"help2\",\r\n      };\r\n    }\r\n\r\n    case \"ROTATE_IMAGE\": {\r\n      let imagesTransform = state.imagesTransform.concat();\r\n      imagesTransform[action.index].r = action.rotation;\r\n      return {\r\n        ...state,\r\n        imagesTransform,\r\n      };\r\n    }\r\n\r\n    case \"SCALE_IMAGE\": {\r\n      let imagesTransform = state.imagesTransform.concat();\r\n      imagesTransform[action.index].s = action.scale;\r\n      return {\r\n        ...state,\r\n        imagesTransform,\r\n      };\r\n    }\r\n\r\n    case \"CLEAR_IMAGE\": {\r\n      let addImagesSrc = state.addImagesSrc.concat();\r\n      addImagesSrc[action.index] = null;\r\n      return {\r\n        ...state,\r\n        addImagesSrc,\r\n        imageChanged: true,\r\n      };\r\n    }\r\n\r\n    case \"SAVE_IMAGES\": {\r\n      return {\r\n        ...state,\r\n        saveImages: true,\r\n        target: action.target,\r\n      };\r\n    }\r\n\r\n    case \"IMAGES_SAVED\": {\r\n      return {\r\n        ...state,\r\n        resultImagesSrc: action.images,\r\n        saveImages: false,\r\n        imagesSaved: true,\r\n      };\r\n    }\r\n\r\n    case \"APP_INIT\": {\r\n      return {\r\n        ...state,\r\n        ...action.data,\r\n      };\r\n    }\r\n\r\n    case \"SET_STORE_DATA\": {\r\n      return {\r\n        ...state,\r\n        ...action.data,\r\n        loaded: true,\r\n      };\r\n    }\r\n\r\n    case \"CLEAR_ACTION\": {\r\n      return {\r\n        ...state,\r\n        action: null,\r\n        imageChanged: false,\r\n        imagesSaved: false,\r\n      };\r\n    }\r\n\r\n    case \"RESET_ACTION\": {\r\n      let imagesTransform = [{ s: 1, r: 0 }];\r\n      return {\r\n        ...state,\r\n        imagesTransform,\r\n      };\r\n    }\r\n\r\n    case \"OPACITY_ON_ACTION\": {\r\n      return {\r\n        ...state,\r\n        showOpacity: true,\r\n      };\r\n    }\r\n\r\n    case \"OPACITY_OFF_ACTION\": {\r\n      return {\r\n        ...state,\r\n        showOpacity: false,\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nconst mainReducer = (state = {}, action) => {\r\n  if (action.extraAction) {\r\n    state = mainReducer(state, action.extraAction);\r\n  }\r\n\r\n  state = mainReducerController(state, action);\r\n\r\n  return state;\r\n};\r\n\r\nexport default mainReducer;\r\n","/* eslint-env browser, node */\n\nfunction isDataURL(str) {\n  if (str === null) {\n    return false\n  }\n  const regex = /^\\s*data:([a-z]+\\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\\-._~:@/?%\\s]*\\s*$/i\n  return !!str.match(regex)\n}\n\nexport default function loadImageURL(imageURL, crossOrigin) {\n  return new Promise((resolve, reject) => {\n    const image = new Image()\n    image.onload = () => resolve(image)\n    image.onerror = reject\n    if (isDataURL(imageURL) === false && crossOrigin) {\n      image.crossOrigin = crossOrigin\n    }\n    image.src = imageURL\n  })\n}\n","/* eslint-env browser, node */\nimport PropTypes from \"prop-types\";\nimport React from \"react\";\n\nimport loadImageURL from \"./utils/load-image-url\";\nimport loadImageFile from \"./utils/load-image-file\";\n\nconst makeCancelable = (promise) => {\n  let hasCanceled_ = false;\n\n  const wrappedPromise = new Promise((resolve, reject) => {\n    /* eslint-disable prefer-promise-reject-errors */\n    promise.then(\n      (val) => (hasCanceled_ ? reject({ isCanceled: true }) : resolve(val)),\n      (error) => (hasCanceled_ ? reject({ isCanceled: true }) : reject(error))\n    );\n    /* eslint-enable */\n  });\n\n  return {\n    promise: wrappedPromise,\n    cancel() {\n      hasCanceled_ = true;\n    },\n  };\n};\n\nconst isTouchDevice = !!(\n  typeof window !== \"undefined\" &&\n  typeof navigator !== \"undefined\" &&\n  (\"ontouchstart\" in window || navigator.msMaxTouchPoints > 0)\n);\n\nconst isFileAPISupported = typeof File !== \"undefined\";\n\nconst isPassiveSupported = () => {\n  // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\n  let passiveSupported = false;\n  try {\n    const options = Object.defineProperty({}, \"passive\", {\n      get: function () {\n        passiveSupported = true;\n      },\n    });\n\n    window.addEventListener(\"test\", options, options);\n    window.removeEventListener(\"test\", options, options);\n  } catch (err) {\n    passiveSupported = false;\n  }\n  return passiveSupported;\n};\n\nconst draggableEvents = {\n  touch: {\n    react: {\n      down: \"onTouchStart\",\n      mouseDown: \"onMouseDown\",\n      drag: \"onTouchMove\",\n      move: \"onTouchMove\",\n      mouseMove: \"onMouseMove\",\n      up: \"onTouchEnd\",\n      mouseUp: \"onMouseUp\",\n    },\n    native: {\n      down: \"touchstart\",\n      mouseDown: \"mousedown\",\n      drag: \"touchmove\",\n      move: \"touchmove\",\n      mouseMove: \"mousemove\",\n      up: \"touchend\",\n      mouseUp: \"mouseup\",\n    },\n  },\n  desktop: {\n    react: {\n      down: \"onMouseDown\",\n      drag: \"onDragOver\",\n      move: \"onMouseMove\",\n      up: \"onMouseUp\",\n    },\n    native: {\n      down: \"mousedown\",\n      drag: \"dragStart\",\n      move: \"mousemove\",\n      up: \"mouseup\",\n    },\n  },\n};\nconst deviceEvents = isTouchDevice\n  ? draggableEvents.touch\n  : draggableEvents.desktop;\n\nlet pixelRatio =\n  typeof window !== \"undefined\" && window.devicePixelRatio\n    ? window.devicePixelRatio\n    : 1;\n\n// Draws a rounded rectangle on a 2D context.\nconst drawRoundedRect = (context, x, y, width, height, borderRadius) => {\n  if (borderRadius === 0) {\n    context.rect(x, y, width, height);\n  } else {\n    const widthMinusRad = width - borderRadius;\n    const heightMinusRad = height - borderRadius;\n    context.translate(x, y);\n    context.arc(\n      borderRadius,\n      borderRadius,\n      borderRadius,\n      Math.PI,\n      Math.PI * 1.5\n    );\n    context.lineTo(widthMinusRad, 0);\n    context.arc(\n      widthMinusRad,\n      borderRadius,\n      borderRadius,\n      Math.PI * 1.5,\n      Math.PI * 2\n    );\n    context.lineTo(width, heightMinusRad);\n    context.arc(\n      widthMinusRad,\n      heightMinusRad,\n      borderRadius,\n      Math.PI * 2,\n      Math.PI * 0.5\n    );\n    context.lineTo(borderRadius, height);\n    context.arc(\n      borderRadius,\n      heightMinusRad,\n      borderRadius,\n      Math.PI * 0.5,\n      Math.PI\n    );\n    context.translate(-x, -y);\n  }\n};\n\nconst defaultEmptyImage = {\n  x: 0.5,\n  y: 0.5,\n};\n\nclass AvatarEditor extends React.Component {\n  //\n  // static propTypes = {\n  //   scale: PropTypes.number,\n  //   rotate: PropTypes.number,\n  //   image: PropTypes.oneOfType([\n  //     PropTypes.string,\n  //     ...(isFileAPISupported ? [PropTypes.instanceOf(File)] : []),\n  //   ]),\n  //   border: PropTypes.oneOfType([\n  //     PropTypes.number,\n  //     PropTypes.arrayOf(PropTypes.number),\n  //   ]),\n  //   borderRadius: PropTypes.number,\n  //   width: PropTypes.number,\n  //   height: PropTypes.number,\n  //   position: PropTypes.shape({\n  //     x: PropTypes.number,\n  //     y: PropTypes.number,\n  //   }),\n  //   color: PropTypes.arrayOf(PropTypes.number),\n  //   crossOrigin: PropTypes.oneOf(['', 'anonymous', 'use-credentials']),\n  //\n  //   onLoadFailure: PropTypes.func,\n  //   onLoadSuccess: PropTypes.func,\n  //   onImageReady: PropTypes.func,\n  //   onImageChange: PropTypes.func,\n  //   onMouseUp: PropTypes.func,\n  //   onMouseMove: PropTypes.func,\n  //   onPositionChange: PropTypes.func,\n  //   disableBoundaryChecks: PropTypes.bool,\n  //   disableHiDPIScaling: PropTypes.bool,\n  //   // disableCanvasRotation: PropTypes.bool,\n  // }\n\n  static defaultProps = {\n    scale: 1,\n    rotate: 0,\n    border: 25,\n    borderRadius: 0,\n    width: 200,\n    height: 200,\n    color: [0, 0, 0, 0.5],\n    onLoadFailure() {},\n    onLoadSuccess() {},\n    onImageReady() {},\n    onImageChange() {},\n    onMouseUp() {},\n    onMouseMove() {},\n    onPositionChange() {},\n    disableBoundaryChecks: false,\n    disableHiDPIScaling: false,\n    // disableCanvasRotation: true,\n  };\n\n  constructor(props) {\n    super(props);\n    this.canvas = null;\n  }\n\n  state = {\n    drag: false,\n    my: null,\n    mx: null,\n    image: defaultEmptyImage,\n  };\n\n  componentDidMount() {\n    // scaling by the devicePixelRatio can impact performance on mobile as it creates a very large canvas. This is an override to increase performance.\n    if (this.props.disableHiDPIScaling) {\n      pixelRatio = 1;\n    }\n    const context = this.canvas.getContext(\"2d\");\n    if (this.props.image) {\n      this.loadImage(this.props.image);\n    }\n    this.paint(context);\n    if (document) {\n      const passiveSupported = isPassiveSupported();\n      const thirdArgument = passiveSupported ? { passive: false } : false;\n\n      const nativeEvents = deviceEvents.native;\n      document.addEventListener(\n        nativeEvents.move,\n        this.handleMouseMove,\n        thirdArgument\n      );\n      document.addEventListener(\n        nativeEvents.up,\n        this.handleMouseUp,\n        thirdArgument\n      );\n      if (isTouchDevice) {\n        document.addEventListener(\n          nativeEvents.mouseMove,\n          this.handleMouseMove,\n          thirdArgument\n        );\n        document.addEventListener(\n          nativeEvents.mouseUp,\n          this.handleMouseUp,\n          thirdArgument\n        );\n      }\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      (this.props.image && this.props.image !== prevProps.image) ||\n      this.props.width !== prevProps.width ||\n      this.props.height !== prevProps.height\n    ) {\n      this.loadImage(this.props.image);\n    } else if (!this.props.image && prevState.image !== defaultEmptyImage) {\n      this.clearImage();\n    }\n\n    const context = this.canvas.getContext(\"2d\");\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.paint(context);\n    this.paintImage(context, this.state.image, this.props.border);\n\n    if (\n      prevProps.image !== this.props.image ||\n      prevProps.width !== this.props.width ||\n      prevProps.height !== this.props.height ||\n      prevProps.position !== this.props.position ||\n      prevProps.scale !== this.props.scale ||\n      prevProps.rotate !== this.props.rotate ||\n      prevState.my !== this.state.my ||\n      prevState.mx !== this.state.mx ||\n      prevState.image.x !== this.state.image.x ||\n      prevState.image.y !== this.state.image.y\n    ) {\n      this.props.onImageChange();\n    }\n  }\n\n  componentWillUnmount() {\n    if (document) {\n      const nativeEvents = deviceEvents.native;\n      document.removeEventListener(\n        nativeEvents.move,\n        this.handleMouseMove,\n        false\n      );\n      document.removeEventListener(nativeEvents.up, this.handleMouseUp, false);\n      if (isTouchDevice) {\n        document.removeEventListener(\n          nativeEvents.mouseMove,\n          this.handleMouseMove,\n          false\n        );\n        document.removeEventListener(\n          nativeEvents.mouseUp,\n          this.handleMouseUp,\n          false\n        );\n      }\n    }\n  }\n\n  isVertical() {\n    //!this.props.disableCanvasRotation &&\n    return this.props.rotate % 180 !== 0;\n  }\n\n  getBorders(border = this.props.border) {\n    return Array.isArray(border) ? border : [border, border];\n  }\n\n  getDimensions() {\n    const { width, height, rotate, border } = this.props;\n\n    const canvas = {};\n\n    const [borderX, borderY] = this.getBorders(border);\n\n    const canvasWidth = width;\n    const canvasHeight = height;\n\n    if (this.isVertical()) {\n      canvas.width = canvasHeight;\n      canvas.height = canvasWidth;\n    } else {\n      canvas.width = canvasWidth;\n      canvas.height = canvasHeight;\n    }\n\n    canvas.width += borderX * 2;\n    canvas.height += borderY * 2;\n\n    return {\n      canvas,\n      rotate,\n      width,\n      height,\n      border,\n    };\n  }\n\n  getImage() {\n    // get relative coordinates (0 to 1)\n    const cropRect = this.getCroppingRect();\n    const image = this.state.image;\n\n    // get actual pixel coordinates\n    cropRect.x *= image.resource.width;\n    cropRect.y *= image.resource.height;\n    cropRect.width *= image.resource.width;\n    cropRect.height *= image.resource.height;\n\n    // create a canvas with the correct dimensions\n    const canvas = document.createElement(\"canvas\");\n\n    if (this.isVertical()) {\n      canvas.width = cropRect.height;\n      canvas.height = cropRect.width;\n    } else {\n      canvas.width = cropRect.width;\n      canvas.height = cropRect.height;\n    }\n\n    // draw the full-size image at the correct position,\n    // the image gets truncated to the size of the canvas.\n    const context = canvas.getContext(\"2d\");\n\n    context.translate(canvas.width / 2, canvas.height / 2);\n    context.rotate((this.props.rotate * Math.PI) / 180);\n    context.translate(-(canvas.width / 2), -(canvas.height / 2));\n\n    if (this.isVertical()) {\n      context.translate(\n        (canvas.width - canvas.height) / 2,\n        (canvas.height - canvas.width) / 2\n      );\n    }\n\n    context.drawImage(image.resource, -cropRect.x, -cropRect.y);\n\n    return canvas;\n  }\n\n  /**\n   * Get the image scaled to original canvas size.\n   * This was default in 4.x and is now kept as a legacy method.\n   */\n  getImageScaledToCanvas() {\n    const { width, height } = this.getDimensions();\n\n    const canvas = document.createElement(\"canvas\");\n\n    if (this.isVertical()) {\n      canvas.width = height;\n      canvas.height = width;\n    } else {\n      canvas.width = width;\n      canvas.height = height;\n    }\n\n    // don't paint a border here, as it is the resulting image\n    this.paintImage(canvas.getContext(\"2d\"), this.state.image, 0, 1);\n\n    return canvas;\n  }\n\n  getXScale() {\n    const canvasAspect = this.props.width / this.props.height;\n    const imageAspect = this.state.image.width / this.state.image.height;\n\n    return Math.min(1, canvasAspect / imageAspect);\n  }\n\n  getYScale() {\n    const canvasAspect = this.props.height / this.props.width;\n    const imageAspect = this.state.image.height / this.state.image.width;\n\n    return Math.min(1, canvasAspect / imageAspect);\n  }\n\n  getCroppingRect() {\n    const position = this.props.position || {\n      x: this.state.image.x,\n      y: this.state.image.y,\n    };\n    const width = (1 / this.props.scale) * this.getXScale();\n    const height = (1 / this.props.scale) * this.getYScale();\n\n    const croppingRect = {\n      x: position.x - width / 2,\n      y: position.y - height / 2,\n      width,\n      height,\n    };\n\n    let xMin = 0;\n    let xMax = 1 - croppingRect.width;\n    let yMin = 0;\n    let yMax = 1 - croppingRect.height;\n\n    // If the cropping rect is larger than the image, then we need to change\n    // our maxima & minima for x & y to allow the image to appear anywhere up\n    // to the very edge of the cropping rect.\n    const isLargerThanImage =\n      this.props.disableBoundaryChecks || width > 1 || height > 1;\n\n    if (isLargerThanImage) {\n      xMin = -croppingRect.width;\n      xMax = 1;\n      yMin = -croppingRect.height;\n      yMax = 1;\n    }\n\n    return {\n      ...croppingRect,\n      x: Math.max(xMin, Math.min(croppingRect.x, xMax)),\n      y: Math.max(yMin, Math.min(croppingRect.y, yMax)),\n    };\n  }\n\n  loadImage(image) {\n    if (isFileAPISupported && image instanceof File) {\n      this.loadingImage = makeCancelable(loadImageFile(image))\n        .promise.then(this.handleImageReady)\n        .catch(this.props.onLoadFailure);\n    } else if (typeof image === \"string\") {\n      this.loadingImage = makeCancelable(\n        loadImageURL(image, this.props.crossOrigin)\n      )\n        .promise.then(this.handleImageReady)\n        .catch(this.props.onLoadFailure);\n    }\n  }\n\n  handleImageReady = (image) => {\n    const imageState = this.getInitialSize(image.width, image.height);\n    imageState.resource = image;\n    imageState.x = 0.5;\n    imageState.y = 0.5;\n    this.setState({ drag: false, image: imageState }, this.props.onImageReady);\n    this.props.onLoadSuccess(imageState);\n  };\n\n  getInitialSize(width, height) {\n    let newHeight;\n    let newWidth;\n\n    const dimensions = this.getDimensions();\n    const canvasRatio = dimensions.height / dimensions.width;\n    const imageRatio = height / width;\n\n    if (canvasRatio > imageRatio) {\n      newHeight = this.getDimensions().height;\n      newWidth = width * (newHeight / height);\n    } else {\n      newWidth = this.getDimensions().width;\n      newHeight = height * (newWidth / width);\n    }\n\n    return {\n      height: newHeight,\n      width: newWidth,\n    };\n  }\n\n  clearImage = () => {\n    const context = this.canvas.getContext(\"2d\");\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.setState({\n      image: defaultEmptyImage,\n    });\n  };\n\n  paintImage(context, image, border, scaleFactor = pixelRatio) {\n    if (image.resource) {\n      const position = this.calculatePosition(image, border);\n\n      context.save();\n\n      context.translate(context.canvas.width / 2, context.canvas.height / 2);\n      context.rotate((this.props.rotate * Math.PI) / 180);\n      context.translate(\n        -(context.canvas.width / 2),\n        -(context.canvas.height / 2)\n      );\n\n      if (this.isVertical()) {\n        context.translate(\n          (context.canvas.width - context.canvas.height) / 2,\n          (context.canvas.height - context.canvas.width) / 2\n        );\n      }\n\n      context.scale(scaleFactor, scaleFactor);\n\n      context.globalCompositeOperation = \"destination-over\";\n      context.drawImage(\n        image.resource,\n        position.x,\n        position.y,\n        position.width,\n        position.height\n      );\n\n      context.restore();\n    }\n  }\n\n  calculatePosition(image, border) {\n    image = image || this.state.image;\n\n    const [borderX, borderY] = this.getBorders(border);\n\n    const croppingRect = this.getCroppingRect();\n\n    const width = image.width * this.props.scale;\n    const height = image.height * this.props.scale;\n\n    let x = -croppingRect.x * width;\n    let y = -croppingRect.y * height;\n\n    if (this.isVertical()) {\n      x += borderY;\n      y += borderX;\n    } else {\n      x += borderX;\n      y += borderY;\n    }\n\n    return {\n      x,\n      y,\n      height,\n      width,\n    };\n  }\n\n  paint(context) {\n    context.save();\n    context.scale(pixelRatio, pixelRatio);\n    context.translate(0, 0);\n    context.fillStyle = \"rgba(\" + this.props.color.slice(0, 4).join(\",\") + \")\";\n\n    let borderRadius = this.props.borderRadius;\n    const dimensions = this.getDimensions();\n    const [borderSizeX, borderSizeY] = this.getBorders(dimensions.border);\n    const height = dimensions.canvas.height;\n    const width = dimensions.canvas.width;\n\n    // clamp border radius between zero (perfect rectangle) and half the size without borders (perfect circle or \"pill\")\n    borderRadius = Math.max(borderRadius, 0);\n    borderRadius = Math.min(\n      borderRadius,\n      width / 2 - borderSizeX,\n      height / 2 - borderSizeY\n    );\n\n    context.beginPath();\n    // inner rect, possibly rounded\n    drawRoundedRect(\n      context,\n      borderSizeX,\n      borderSizeY,\n      width - borderSizeX * 2,\n      height - borderSizeY * 2,\n      borderRadius\n    );\n    context.rect(width, 0, -width, height); // outer rect, drawn \"counterclockwise\"\n    context.fill(\"evenodd\");\n\n    context.restore();\n  }\n\n  handleMouseDown = (e) => {\n    e = e || window.event;\n    // if e is a touch event, preventDefault keeps\n    // corresponding mouse events from also being fired\n    // later.\n    e.preventDefault();\n    this.setState({\n      drag: true,\n      mx: null,\n      my: null,\n    });\n  };\n  handleMouseUp = () => {\n    if (this.state.drag) {\n      this.setState({ drag: false });\n      this.props.onMouseUp();\n    }\n  };\n\n  getElementScale = (element, scale) => {\n    let eScale = 1;\n    if (element.style.transform) {\n      let matrixRegex =\n        /matrix\\(\\s*(-*\\d*\\.*\\d*),\\s*-*\\d*\\.*\\d*,\\s*-*\\d*\\.*\\d*,\\s*(-*\\d*\\.*\\d*),\\s*-*\\d*\\.*\\d*,\\s*-*\\d*\\.*\\d*\\)/gm;\n      let matches = matrixRegex.exec(element.style.transform);\n      if (!matches) {\n        matrixRegex = /scale\\(\\s*(-*\\d*\\.*\\d*)\\)/gm;\n        matches = matrixRegex.exec(element.style.transform);\n      }\n      if (!matches) {\n        eScale = 1;\n      } else {\n        eScale = Number(matches[1]);\n      }\n    }\n    scale = scale * eScale;\n    if (element.parentElement) {\n      scale = this.getElementScale(element.parentElement, scale);\n    }\n    return scale;\n  };\n\n  handleMouseMove = (e) => {\n    e = e || window.event;\n    if (this.state.drag === false) {\n      return;\n    }\n\n    e.preventDefault(); // stop scrolling on iOS Safari\n\n    let scale = 1 / this.getElementScale(this.props.containerref.current, 1);\n\n    const mousePositionX =\n      (e.targetTouches ? e.targetTouches[0].pageX : e.clientX) * scale;\n    const mousePositionY =\n      (e.targetTouches ? e.targetTouches[0].pageY : e.clientY) * scale;\n\n    const newState = {\n      mx: mousePositionX,\n      my: mousePositionY,\n    };\n\n    let rotate = this.props.rotate;\n\n    rotate %= 360;\n    rotate = rotate < 0 ? rotate + 360 : rotate;\n\n    if (this.state.mx && this.state.my) {\n      const mx = this.state.mx - mousePositionX;\n      const my = this.state.my - mousePositionY;\n\n      const width = this.state.image.width * this.props.scale;\n      const height = this.state.image.height * this.props.scale;\n\n      let { x: lastX, y: lastY } = this.getCroppingRect();\n\n      lastX *= width;\n      lastY *= height;\n\n      // helpers to calculate vectors\n      const toRadians = (degree) => degree * (Math.PI / 180);\n      const cos = Math.cos(toRadians(rotate));\n      const sin = Math.sin(toRadians(rotate));\n\n      const x = lastX + mx * cos + my * sin;\n      const y = lastY + -mx * sin + my * cos;\n\n      const relativeWidth = (1 / this.props.scale) * this.getXScale();\n      const relativeHeight = (1 / this.props.scale) * this.getYScale();\n\n      const position = {\n        x: x / width + relativeWidth / 2,\n        y: y / height + relativeHeight / 2,\n      };\n\n      this.props.onPositionChange(position);\n\n      newState.image = {\n        ...this.state.image,\n        ...position,\n      };\n    }\n\n    this.setState(newState);\n\n    this.props.onMouseMove(e);\n  };\n\n  setCanvas = (canvas) => {\n    this.canvas = canvas;\n  };\n\n  render() {\n    const {\n      scale,\n      rotate,\n      image,\n      border,\n      borderRadius,\n      width,\n      height,\n      position,\n      color,\n      // eslint-disable-next-line react/prop-types\n      style,\n      crossOrigin,\n      onLoadFailure,\n      onLoadSuccess,\n      onImageReady,\n      onImageChange,\n      onMouseUp,\n      onMouseMove,\n      onPositionChange,\n      disableBoundaryChecks,\n      disableHiDPIScaling,\n      ...rest\n    } = this.props;\n\n    const dimensions = this.getDimensions();\n    const defaultStyle = {\n      width: dimensions.canvas.width,\n      height: dimensions.canvas.height,\n      cursor: this.state.drag ? \"grabbing\" : \"grab\",\n      touchAction: \"none\",\n    };\n\n    const attributes = {\n      width: dimensions.canvas.width * pixelRatio,\n      height: dimensions.canvas.height * pixelRatio,\n      style: {\n        ...defaultStyle,\n        ...style,\n      },\n    };\n\n    attributes[deviceEvents.react.down] = this.handleMouseDown;\n    if (isTouchDevice) {\n      attributes[deviceEvents.react.mouseDown] = this.handleMouseDown;\n    }\n\n    return <canvas id=\"edtr\" ref={this.setCanvas} {...attributes} {...rest} />;\n  }\n}\n\nexport default AvatarEditor;\n","/* eslint-env browser, node */\nimport loadImageURL from './load-image-url'\n\nexport default function loadImageFile(imageFile) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = e => {\n      try {\n        const image = loadImageURL(e.target.result)\n        resolve(image)\n      } catch (e) {\n        reject(e)\n      }\n    }\n    reader.readAsDataURL(imageFile)\n  })\n}\n","export const clearHelp = () => {\r\n  return {\r\n    type: \"CLEAR_HELP\",\r\n  };\r\n};\r\n\r\nexport const useImage = (index, src) => {\r\n  return {\r\n    type: \"USE_IMAGE\",\r\n    index,\r\n    src,\r\n  };\r\n};\r\n\r\nexport const clearImage = (index) => {\r\n  return {\r\n    type: \"CLEAR_IMAGE\",\r\n    index,\r\n  };\r\n};\r\n\r\nexport const rotateImage = (index, rotation) => {\r\n  return {\r\n    type: \"ROTATE_IMAGE\",\r\n    index,\r\n    rotation,\r\n  };\r\n};\r\n\r\nexport const scaleImage = (index, scale) => {\r\n  return {\r\n    type: \"SCALE_IMAGE\",\r\n    index,\r\n    scale,\r\n  };\r\n};\r\n\r\nexport const clearAction = () => {\r\n  return {\r\n    type: \"CLEAR_ACTION\",\r\n  };\r\n};\r\n\r\nexport const resetAction = () => {\r\n  return {\r\n    type: \"RESET_ACTION\",\r\n  };\r\n};\r\n\r\nexport const saveImages = (target) => {\r\n  return {\r\n    type: \"SAVE_IMAGES\",\r\n    target: target,\r\n  };\r\n};\r\n\r\nexport const imagesSaved = (images) => {\r\n  return {\r\n    type: \"IMAGES_SAVED\",\r\n    images,\r\n  };\r\n};\r\n\r\nexport const appInit = (data) => {\r\n  return {\r\n    type: \"APP_INIT\",\r\n    data: {\r\n      ...data,\r\n    },\r\n  };\r\n};\r\n\r\nexport const setStoreData = (data) => {\r\n  return {\r\n    type: \"SET_STORE_DATA\",\r\n    data: {\r\n      ...data,\r\n    },\r\n  };\r\n};\r\n\r\nexport const loadStoreDataError = (data) => {\r\n  return {\r\n    type: \"LOAD_STORE_DATA_ERROR\",\r\n    data: {\r\n      ...data,\r\n      dataLoaded: false,\r\n      reloadData: false,\r\n      loadDataError: true,\r\n    },\r\n  };\r\n};\r\n\r\nexport const reloadStoreData = () => {\r\n  return {\r\n    type: \"RELOAD_STORE_DATA\",\r\n    data: {\r\n      dataLoaded: false,\r\n      reloadData: true,\r\n      loadDataError: false,\r\n    },\r\n  };\r\n};\r\n\r\nexport const waitingForReloadStoreData = () => {\r\n  return {\r\n    type: \"WAITING_FOR_RELOAD_STORE_DATA\",\r\n    data: {\r\n      dataLoaded: false,\r\n    },\r\n  };\r\n};\r\n\r\nexport const setAppData = (data) => {\r\n  return {\r\n    type: \"SET_APP_DATA\",\r\n    data,\r\n  };\r\n};\r\n\r\nexport const setStorageData = (data) => {\r\n  return {\r\n    type: \"SET_STORAGE_DATA\",\r\n    data,\r\n  };\r\n};\r\n\r\nexport const saveStorageData = () => {\r\n  return {\r\n    type: \"SAVE_STORAGE_DATA\",\r\n    data: {\r\n      saveStorageData: true,\r\n      dataForStorageChanged: null,\r\n    },\r\n  };\r\n};\r\n\r\nexport const storageDataSaved = () => {\r\n  return {\r\n    type: \"STORAGE_DATA_SAVED\",\r\n    data: {\r\n      saveStorageData: false,\r\n    },\r\n  };\r\n};\r\n\r\nexport const opacityOnAction = () => {\r\n  return {\r\n    type: \"OPACITY_ON_ACTION\",\r\n  };\r\n};\r\n\r\nexport const opacityOffAction = () => {\r\n  return {\r\n    type: \"OPACITY_OFF_ACTION\",\r\n  };\r\n};\r\n","import React, { Component } from \"react\";\r\nimport AvatarEditor from \"../improve/react-avatar-editor\";\r\n\r\nimport { updateImage, useImage, imagesSaved } from \"../actions/appActions\";\r\n\r\nclass Editor extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {};\r\n    this.store = this.props.store;\r\n\r\n    this.targetRefs = [];\r\n    this.containerRefs = [];\r\n    for (let i = 0; i < 1; i++) {\r\n      this.targetRefs.push(React.createRef());\r\n      this.containerRefs.push(React.createRef());\r\n    }\r\n\r\n    this.containerRef = React.createRef();\r\n    this.state = {};\r\n    this.loadButton_clickHandler = this.loadButton_clickHandler.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe = this.store.subscribe(() => {\r\n      this.onStoreChange();\r\n    });\r\n    this.mounted = true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted = false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {}\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state = this.store.getState();\r\n      this.setState(state);\r\n\r\n      if (state.saveImages) {\r\n        let images = [];\r\n        for (let i = 0; i < this.targetRefs.length; i++) {\r\n          let targetRef = this.targetRefs[i];\r\n          if (targetRef.current) {\r\n            images.push(\r\n              targetRef.current\r\n                .getImageScaledToCanvas()\r\n                .toDataURL(this.state.mimeType)\r\n            );\r\n          } else {\r\n            images.push(null);\r\n          }\r\n        }\r\n        this.store.dispatch(imagesSaved(images));\r\n      }\r\n    }\r\n  }\r\n\r\n  loadButton_clickHandler(event) {\r\n    let index = Number(event.target.id.substr(3));\r\n    let file = event.target.files[0];\r\n    if (file) {\r\n      var reader = new FileReader();\r\n\r\n      reader.onload = ((theIndex, store) => {\r\n        return (e) => {\r\n          this.store.dispatch(useImage(index, e.target.result));\r\n        };\r\n      })(index, this.store);\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    if (this.state.addImagesSrc) {\r\n      let indexes = [];\r\n      for (let i = 0; i < this.state.addImagesSrc.length; i++) {\r\n        let imageSrc = this.state.addImagesSrc[i];\r\n        let addImageTransform = this.state.addImagesTransform[i];\r\n        let imageTransform = this.state.imagesTransform[i];\r\n\r\n        if (\r\n          imageSrc &&\r\n          imageSrc !== \"\" &&\r\n          addImageTransform &&\r\n          imageTransform\r\n        ) {\r\n          children.push(\r\n            <div\r\n              key={\"cnt\" + i}\r\n              id={\"cnt\" + i}\r\n              className=\"editorImageContainer\"\r\n              ref={this.containerRefs[i]}\r\n              style={{\r\n                transform: `matrix(${addImageTransform})`,\r\n                width: this.state.addImagesRealSize.width,\r\n                height: this.state.addImagesRealSize.height,\r\n                pointerEvents:\r\n                  this.state.editable && this.state.publishable\r\n                    ? \"all\"\r\n                    : \"none\",\r\n              }}\r\n            >\r\n              <div\r\n                key=\"EditorCircleMask\"\r\n                className=\"editorCircleMask\"\r\n                style={this.state.maskMargins}\r\n              >\r\n                <AvatarEditor\r\n                  ref={this.targetRefs[i]}\r\n                  image={imageSrc}\r\n                  containerref={this.containerRefs[i]}\r\n                  width={\r\n                    this.state.addImagesRealSize.width -\r\n                    this.state.maskMargins.left -\r\n                    this.state.maskMargins.right\r\n                  }\r\n                  height={\r\n                    this.state.addImagesRealSize.height -\r\n                    this.state.maskMargins.bottom -\r\n                    this.state.maskMargins.top\r\n                  }\r\n                  border={0}\r\n                  scale={imageTransform.s}\r\n                  rotate={imageTransform.r}\r\n                />\r\n              </div>\r\n            </div>\r\n          );\r\n        } else {\r\n          children.push(\r\n            <div\r\n              id={\"lBt\" + i}\r\n              key={\"lBt\" + i}\r\n              className=\"loadButton\"\r\n              style={{\r\n                transform: `matrix(${addImageTransform})`,\r\n                width: this.state.addImagesRealSize.width,\r\n                height: this.state.addImagesRealSize.height,\r\n                pointerEvents: this.state.editable ? \"all\" : \"none\",\r\n              }}\r\n            >\r\n              <input\r\n                id={\"inp\" + i}\r\n                type=\"file\"\r\n                onChange={this.loadButton_clickHandler}\r\n                className=\"loadInput\"\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    return React.createElement(\r\n      \"div\",\r\n      { id: \"Editor\", style: this.props.style, ref: this.containerRef },\r\n      children\r\n    );\r\n  }\r\n}\r\n\r\nexport default Editor;\r\n","import React, { Component } from \"react\";\r\n\r\nimport { rotateImage, scaleImage, clearImage } from \"../actions/appActions\";\r\n\r\nclass Controls extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {};\r\n    this.store = this.props.store;\r\n\r\n    this.containerRefs = [];\r\n    for (let i = 0; i < 10; i++) {\r\n      this.containerRefs.push(React.createRef());\r\n    }\r\n\r\n    this.containerRef = React.createRef();\r\n    this.state = {};\r\n\r\n    this.scaleRange_changeHandler = this.scaleRange_changeHandler.bind(this);\r\n    this.rotateRange_changeHandler = this.rotateRange_changeHandler.bind(this);\r\n    this.clearButton_clickHandler = this.clearButton_clickHandler.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe = this.store.subscribe(() => {\r\n      this.onStoreChange();\r\n    });\r\n    this.mounted = true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted = false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {}\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state = this.store.getState();\r\n      this.setState(state);\r\n    }\r\n  }\r\n\r\n  scaleRange_changeHandler(event) {\r\n    let index = Number(event.target.id.substr(3));\r\n    this.store.dispatch(scaleImage(index, event.target.value));\r\n  }\r\n\r\n  rotateRange_changeHandler(event) {\r\n    let index = Number(event.target.id.substr(3));\r\n    this.store.dispatch(rotateImage(index, event.target.value));\r\n  }\r\n\r\n  clearButton_clickHandler(event) {\r\n    let index = Number(event.target.id.substr(3));\r\n    this.store.dispatch(clearImage(index, event.target.value));\r\n  }\r\n\r\n  render() {\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    if (this.state.addImagesSrc) {\r\n      let indexes = [];\r\n      for (let i = 0; i < this.state.addImagesSrc.length; i++) {\r\n        let imageSrc = this.state.addImagesSrc[i];\r\n        let addImageTransform = this.state.addImagesTransform[i];\r\n        let imageTransform = this.state.imagesTransform[i];\r\n\r\n        if (\r\n          imageSrc &&\r\n          imageSrc !== \"\" &&\r\n          addImageTransform &&\r\n          imageTransform\r\n        ) {\r\n          children.push(\r\n            <div\r\n              key={\"ctl\" + i}\r\n              id={\"ctl\" + i}\r\n              className=\"controlsContainer\"\r\n              ref={this.containerRefs[i]}\r\n              style={{\r\n                transform: `matrix(${addImageTransform})`,\r\n                width: this.state.addImagesDefaultSize.width,\r\n                height: this.state.addImagesDefaultSize.height,\r\n              }}\r\n            >\r\n              <input\r\n                type=\"range\"\r\n                id={\"srn\" + i}\r\n                name={\"srn\" + i}\r\n                min={this.state.minScale}\r\n                max={this.state.maxScale}\r\n                step=\"0.01\"\r\n                value={imageTransform.s}\r\n                className=\"scaleRange\"\r\n                onChange={this.scaleRange_changeHandler}\r\n              />\r\n              <input\r\n                type=\"range\"\r\n                id={\"rrn\" + i}\r\n                name={\"rrn\" + i}\r\n                min={this.state.minRotation}\r\n                max={this.state.maxRotation}\r\n                step=\"1\"\r\n                value={imageTransform.r}\r\n                className=\"rotateRange\"\r\n                onChange={this.rotateRange_changeHandler}\r\n              />\r\n              {/* <div\r\n                key={\"ldb\" + i}\r\n                id={\"ldb\" + i}\r\n                className=\"clearImageButton\"\r\n                onClick={this.clearButton_clickHandler}\r\n              ></div> */}\r\n            </div>\r\n          );\r\n        }\r\n      }\r\n\r\n      // if (this.state.showHelp) {\r\n      //   switch (this.state.currentHelp) {\r\n      //     case \"help1\":\r\n      //     {\r\n      //       children.push(\r\n      //         <img\r\n      //         id=\"help\"\r\n      //         key=\"help\"\r\n      //         src={this.state.help1ImageSrc}\r\n      //         />\r\n      //       );\r\n      //       break;\r\n      //     }\r\n      //     case \"help2\":\r\n      //     {\r\n      //       children.push(\r\n      //         <img\r\n      //         id=\"help\"\r\n      //         key=\"help\"\r\n      //         src={this.state.help2ImageSrc}\r\n      //         />\r\n      //       );\r\n      //       break;\r\n      //     }\r\n      //     default:\r\n\r\n      //   }\r\n      // }\r\n    }\r\n\r\n    return React.createElement(\r\n      \"div\",\r\n      { id: \"Controls\", style: this.props.style, ref: this.containerRef },\r\n      children\r\n    );\r\n  }\r\n}\r\n\r\nexport default Controls;\r\n","import React, { Component } from \"react\";\r\nimport Editor from \"./Editor.js\";\r\nimport Controls from \"./Controls.js\";\r\n\r\nimport {\r\n  saveImages,\r\n  setStoreData,\r\n  clearHelp,\r\n  useImage,\r\n  resetAction,\r\n  opacityOnAction,\r\n  opacityOffAction,\r\n} from \"../actions/appActions\";\r\n\r\nclass EditorPlace extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.store = this.props.store;\r\n\r\n    this.ref = React.createRef();\r\n    this.containerRef = React.createRef();\r\n    this.editorRef = React.createRef();\r\n\r\n    this.state = {\r\n      editorScale: 0.15,\r\n      editorX: 0,\r\n      editorY: 0,\r\n    };\r\n\r\n    this.loadButton_clickHandler = this.loadButton_clickHandler.bind(this);\r\n\r\n    this.publishSaveButton_clickHandler =\r\n      this.publishSaveButton_clickHandler.bind(this);\r\n\r\n    this.themeButton_clickHandler = this.themeButton_clickHandler.bind(this);\r\n    this.resetButton_clickHandler = this.resetButton_clickHandler.bind(this);\r\n\r\n    this.mouseDownHandler = this.mouseDownHandler.bind(this);\r\n    this.mouseUpHandler = this.mouseUpHandler.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe = this.store.subscribe(() => {\r\n      this.onStoreChange();\r\n    });\r\n    this.mounted = true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted = false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n    this.updateBounds(\r\n      this.ref.current.clientWidth,\r\n      this.ref.current.clientHeight\r\n    );\r\n  }\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state = this.store.getState();\r\n      this.setState({\r\n        ...this.state,\r\n        ...state,\r\n      });\r\n    }\r\n  }\r\n\r\n  updateBounds(width, height) {\r\n    if (this.lastWidth !== width || this.lastHeight !== height) {\r\n      if (this.state.editorBounds) {\r\n        this.lastWidth = width;\r\n        this.lastHeight = height;\r\n        let bounds = this.state.editorBounds;\r\n        let editorScale = Math.min(\r\n          width / bounds.width,\r\n          height / bounds.height\r\n        );\r\n        let editorX = (width - bounds.width * editorScale) / 2 / editorScale;\r\n        let editorY = (height - bounds.height * editorScale) / 2 / editorScale;\r\n        this.setState({\r\n          ...this.state,\r\n          editorScale,\r\n          editorX,\r\n          editorY,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  publish(target) {\r\n    this.store.dispatch(setStoreData({ publishable: false }));\r\n    setTimeout(() => {\r\n      this.store.dispatch(setStoreData({ publishable: true }));\r\n    }, this.state.republishInterval);\r\n    this.store.dispatch(saveImages(target));\r\n  }\r\n\r\n  loadButton_clickHandler(event) {\r\n    let index = Number(event.target.id.substr(3));\r\n    let file = event.target.files[0];\r\n    if (file) {\r\n      var reader = new FileReader();\r\n\r\n      reader.onload = ((theIndex, store) => {\r\n        return (e) => {\r\n          this.store.dispatch(useImage(index, e.target.result));\r\n        };\r\n      })(index, this.store);\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  publishSaveButton_clickHandler(event) {\r\n    this.publish(\"save\");\r\n  }\r\n\r\n  themeButton_clickHandler(event) {\r\n    if (this.state.theme == \"dark\") {\r\n      this.store.dispatch(setStoreData({ theme: \"light\" }));\r\n    } else {\r\n      this.store.dispatch(setStoreData({ theme: \"dark\" }));\r\n    }\r\n  }\r\n\r\n  resetButton_clickHandler(event) {\r\n    this.store.dispatch(resetAction());\r\n  }\r\n\r\n  mouseDownHandler(event) {\r\n    this.store.dispatch(clearHelp());\r\n    let target = event.target ? event.target.id : \"\";\r\n    if (target === \"edtr\" || target === \"rrn0\" || target === \"srn0\") {\r\n      this.store.dispatch(opacityOnAction());\r\n    }\r\n  }\r\n\r\n  mouseUpHandler() {\r\n    if (this.state.showOpacity) this.store.dispatch(opacityOffAction());\r\n  }\r\n\r\n  render() {\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    let loadedImageCount = 0;\r\n    if (this.state.addImagesSrc) {\r\n      for (let i = 0; i < this.state.addImagesSrc.length; i++) {\r\n        if (this.state.addImagesSrc[i] && this.state.addImagesSrc[i] != \"\") {\r\n          loadedImageCount++;\r\n        }\r\n      }\r\n    }\r\n\r\n    let imageSrc = this.state.addImagesSrc ? this.state.addImagesSrc[0] : null;\r\n\r\n    let addImageTransform = this.state.addImagesTransform\r\n      ? this.state.addImagesTransform[0]\r\n      : null;\r\n    let imageTransform = this.state.imagesTransform\r\n      ? this.state.imagesTransform[0]\r\n      : null;\r\n\r\n    children.push(\r\n      <div\r\n        id=\"EditorContainer\"\r\n        key=\"EditorContainer\"\r\n        ref={this.containerRef}\r\n        style={{\r\n          width: this.state.editorBounds ? this.state.editorBounds.width : 0,\r\n          height: this.state.editorBounds ? this.state.editorBounds.height : 0,\r\n          transform: `scale(${this.state.editorScale}) translateX(${this.state.editorX}px) translateY(${this.state.editorY}px)`,\r\n        }}\r\n      >\r\n        <div id=\"EditorTitle\" key=\"EditorTitle\">\r\n          <img src=\"title.svg\" />\r\n        </div>\r\n        <div id=\"EditorPanel\" key=\"EditorPanel\">\r\n          <img\r\n            id=\"BackImage\"\r\n            key=\"BackImage\"\r\n            style={{\r\n              width: this.state.addImagesDefaultSize\r\n                ? this.state.addImagesDefaultSize.width\r\n                : 0,\r\n              height: this.state.addImagesDefaultSize\r\n                ? this.state.addImagesDefaultSize.height\r\n                : 0,\r\n            }}\r\n            src={\r\n              this.state.backImageSrc\r\n                ? this.state.backImageSrc[this.state.theme]\r\n                : \"\"\r\n            }\r\n          />\r\n          <Editor\r\n            id=\"Editor\"\r\n            key=\"Editor\"\r\n            scale={this.state.editorScale}\r\n            store={this.props.store}\r\n            ref={this.editorRef}\r\n            style={{\r\n              width: this.state.addImagesRealSize\r\n                ? this.state.addImagesRealSize.width\r\n                : 0,\r\n              height: this.state.addImagesRealSize\r\n                ? this.state.addImagesRealSize.height\r\n                : 0,\r\n              transform: `matrix(${this.state.addImagesScale}, 0, 0, ${\r\n                this.state.addImagesScale\r\n              }, ${\r\n                this.state.addImagesRealSize\r\n                  ? -this.state.addImagesRealSize.width / 2\r\n                  : 0\r\n              }, ${\r\n                this.state.addImagesRealSize\r\n                  ? -this.state.addImagesRealSize.height / 2\r\n                  : 0\r\n              })`,\r\n            }}\r\n          />\r\n          <img\r\n            id=\"MainImage\"\r\n            key=\"MainImage\"\r\n            src={\r\n              this.state.mainImageSrc\r\n                ? this.state.mainImageSrc[this.state.theme]\r\n                : \"\"\r\n            }\r\n            style={{\r\n              opacity: this.state.editable && this.state.showOpacity ? 0.5 : 1,\r\n              width: this.state.addImagesDefaultSize\r\n                ? this.state.addImagesDefaultSize.width\r\n                : 0,\r\n              height: this.state.addImagesDefaultSize\r\n                ? this.state.addImagesDefaultSize.height\r\n                : 0,\r\n            }}\r\n          />\r\n          <Controls\r\n            id=\"Controls\"\r\n            key=\"Controls\"\r\n            scale={this.state.editorScale}\r\n            store={this.props.store}\r\n            ref={this.editorRef}\r\n            style={{\r\n              display:\r\n                this.state.editable && this.state.publishable\r\n                  ? \"block\"\r\n                  : \"none\",\r\n              width: this.state.addImagesDefaultSize\r\n                ? this.state.addImagesDefaultSize.width\r\n                : 0,\r\n              height: this.state.addImagesDefaultSize\r\n                ? this.state.addImagesDefaultSize.height\r\n                : 0,\r\n            }}\r\n          />\r\n          <div\r\n            id=\"loadButton\"\r\n            key=\"loadButton\"\r\n            className={imageSrc && imageSrc !== \"\" ? \"replace\" : \"load\"}\r\n            style={{\r\n              pointerEvents:\r\n                this.state.editable && this.state.publishable ? \"all\" : \"none\",\r\n            }}\r\n          >\r\n            <input\r\n              id=\"inp0\"\r\n              type=\"file\"\r\n              onChange={this.loadButton_clickHandler}\r\n              className=\"loadInput\"\r\n            />\r\n          </div>\r\n          <div\r\n            id=\"saveButton\"\r\n            key=\"saveButton\"\r\n            className={\r\n              \"publishButton\" +\r\n              (this.state.publishable &&\r\n              this.state.editable &&\r\n              imageSrc &&\r\n              imageSrc !== \"\" &&\r\n              addImageTransform &&\r\n              imageTransform\r\n                ? \" get-active\"\r\n                : \" get-disabled\")\r\n            }\r\n            onClick={this.publishSaveButton_clickHandler}\r\n          ></div>\r\n          <div\r\n            id=\"themeButton\"\r\n            key=\"themeButton\"\r\n            className={\"theme-\" + this.state.theme}\r\n            onClick={this.themeButton_clickHandler}\r\n            style={{\r\n              pointerEvents:\r\n                this.state.editable && this.state.publishable ? \"all\" : \"none\",\r\n            }}\r\n          ></div>\r\n\r\n          <div\r\n            id=\"resetButton\"\r\n            key=\"resetButton\"\r\n            onClick={this.resetButton_clickHandler}\r\n            style={{\r\n              pointerEvents:\r\n                this.state.editable && this.state.publishable ? \"all\" : \"none\",\r\n\r\n              display:\r\n                this.state.publishable &&\r\n                this.state.editable &&\r\n                imageSrc &&\r\n                imageSrc !== \"\" &&\r\n                addImageTransform &&\r\n                imageTransform\r\n                  ? \"block\"\r\n                  : \"none\",\r\n            }}\r\n          ></div>\r\n        </div>\r\n      </div>\r\n    );\r\n\r\n    return React.createElement(\r\n      \"div\",\r\n      {\r\n        id: \"EditorPlace\",\r\n        style: this.props.style,\r\n        ref: this.ref,\r\n        onMouseDown: this.mouseDownHandler,\r\n        onMouseUp: this.mouseUpHandler,\r\n      },\r\n      children\r\n    );\r\n  }\r\n}\r\n\r\nexport default EditorPlace;\r\n","import React, { Component } from \"react\";\r\n\r\nimport EditorPlace from \"../components/EditorPlace.js\";\r\n\r\nclass Container extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n    this.store = this.props.store;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe = this.store.subscribe(() => {\r\n      this.onStoreChange();\r\n    });\r\n    this.mounted = true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted = false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {}\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state = this.store.getState();\r\n      this.setState(state);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    children.push(\r\n      <EditorPlace\r\n        store={this.store}\r\n        key=\"EditorPlace\"\r\n        style={{\r\n          right: this.state.sideMenu ? this.state.sideMenu.width : 0,\r\n          top: this.state.topMenu ? this.state.topMenu.height : 0,\r\n        }}\r\n      />\r\n    );\r\n\r\n    return React.createElement(\"div\", { id: \"Container\" }, children);\r\n  }\r\n}\r\n\r\nexport default Container;\r\n","import { Component } from 'react';\r\n\r\nimport { setStorageData, storageDataSaved } from '../actions/appActions';\r\n\r\n// import LocalStorageManager from './LocalStorageManager';\r\n\r\nclass DataManager extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.store = this.props.store;\r\n    this.state = {\r\n      isLoading:false,\r\n      isLoaded:false,\r\n    }\r\n    this.loader=null;\r\n    this.result=null;\r\n\r\n  }\r\n\r\n/* ++++ React methods ++++ */\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    // this.load();\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n  }\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state=this.store.getState();\r\n      // this.setState(state);\r\n      if (state.reloadData) {\r\n        // console.log(\"DataManager reloadData\");\r\n        // this.load()\r\n      } else\r\n      if (state.saveStorageData) {\r\n        // console.log(\"DataManager saveStorageData\");\r\n        this.saveStorageData();\r\n      }\r\n    }\r\n  }\r\n\r\n  loadStorageData()\r\n  {\r\n    let data=this.localStorageManager.load();\r\n    this.store.dispatch(\r\n      setStorageData(data)\r\n    );\r\n  }\r\n\r\n  saveStorageData()\r\n  {\r\n    // let state=this.store.getState();\r\n    this.localStorageManager.save({\r\n    });\r\n\r\n    this.store.dispatch(\r\n      storageDataSaved()\r\n    );\r\n  }\r\n\r\n  render () {\r\n    return null;\r\n  }\r\n\r\n}\r\nexport default DataManager;\r\n","import { Component } from 'react';\r\n\r\nimport {\r\n  reloadStoreData,\r\n  saveStorageData,\r\n  clearAction,\r\n } from '../actions/appActions';\r\n\r\nclass Control extends Component {\r\n\r\n  //--------------------------------------------------------------------------\r\n\t//\r\n\t// Constructor\r\n\t//\r\n\t//--------------------------------------------------------------------------\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n    this.store = this.props.store;\r\n\r\n    this.actionMap={\r\n    }\r\n\r\n    this.appStartDelay=500;\r\n\r\n    // console.log(\"Control constructor\");\r\n\r\n  }\r\n\r\n\r\n  //--------------------------------------------------------------------------\r\n  //\r\n  // React methods\r\n  //\r\n  //--------------------------------------------------------------------------\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  //--------------------------------------------------------------------------\r\n  //\r\n  // Own methods\r\n  //\r\n  //--------------------------------------------------------------------------\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n\r\n      let state=this.store.getState();\r\n\r\n      // this.setState(state);\r\n\r\n      if (state.imageChanged) {\r\n          this.props.app.props.onImage(this.props.app);\r\n          this.store.dispatch(\r\n            clearAction()\r\n          );\r\n      }\r\n\r\n      if (state.imagesSaved) {\r\n          this.props.app.props.onImages(this.props.app,state.resultImagesSrc,state.target);\r\n          this.store.dispatch(\r\n            clearAction()\r\n          );\r\n      }\r\n\r\n      //\r\n      //\r\n      // if (state.dataLoaded) {\r\n      //\r\n      //   // console.log(\"Control dataLoaded\",state.windowIsVisible);\r\n      //   if (state.windowIsVisible) {\r\n      //     // console.log(\"Control Wait for next load\");\r\n      //     this.store.dispatch(\r\n      //       waitingForReloadStoreData()\r\n      //     );\r\n      //     this.waitForReload();\r\n      //   } else {\r\n      //     // console.log(\"Tab is inactive. Do not load\");\r\n      //   }\r\n      //\r\n      // } else\r\n      // if (state.loadDataError) {\r\n      //   // console.log(\"Control loadDataError\");\r\n      //   this.store.dispatch(\r\n      //     reloadStoreData()\r\n      //   );\r\n      // } else\r\n      // }\r\n\r\n      if (state.dataForStorageChanged) {\r\n      // console.log(\"Control dataForStorageChanged\");\r\n        this.store.dispatch(\r\n          saveStorageData()\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  stopTimeout() {\r\n    if (this.loadTimeout) {\r\n      clearTimeout(this.loadTimeout)\r\n      this.loadTimeout=null;\r\n    }\r\n  }\r\n\r\n  waitForReload() {\r\n    // console.log(\"Control waitForReload\");\r\n    this.stopTimeout();\r\n\r\n    this.loadTimeout=setTimeout(()=>{\r\n      // console.log(\"Control Reload\");\r\n      this.store.dispatch(\r\n        reloadStoreData()\r\n      );\r\n    },this.store.reloadTimeout);\r\n\r\n  }\r\n\r\n\r\n\r\n  render () {\r\n    return null;\r\n  }\r\n\r\n}\r\n\r\nexport default Control;\r\n","import { isMobile, isLocal } from \"../core/helpers\";\r\n\r\nconst settings = {\r\n  assetsUrl: \".\",\r\n  localStoreName: \"appState_221024\",\r\n\r\n  isMobile: isMobile(),\r\n  isLocal: isLocal(),\r\n\r\n  editorBounds: {\r\n    width: 0,\r\n    height: 0,\r\n  },\r\n\r\n  addImagesDefaultSize: {\r\n    width: 500,\r\n    height: 500,\r\n  },\r\n\r\n  addImagesRealSize: {\r\n    width: 500,\r\n    height: 500,\r\n  },\r\n\r\n  addImagesScale: 1,\r\n\r\n  maskMargins: {\r\n    left: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    top: 0,\r\n  },\r\n\r\n  addImagesDefaultScale: 0.5,\r\n\r\n  mainImageSrc: \"\",\r\n  addImagesSrc: [\"\"],\r\n  addImagesTransform: [null],\r\n\r\n  resultImagesSrc: [\"\"],\r\n\r\n  mainImageSrc: {},\r\n  backImageSrc: {},\r\n\r\n  help1ImageSrc: \"\",\r\n  help2ImageSrc: \"\",\r\n\r\n  currentHelp: \"help1\",\r\n  showHelp: true,\r\n\r\n  minScale: 1,\r\n  maxScale: 20,\r\n\r\n  minRotation: 0,\r\n  maxRotation: 360,\r\n\r\n  imagesTransform: [{ s: 1, r: 0 }],\r\n\r\n  editable: true,\r\n  publishable: true,\r\n\r\n  republishInterval: 5000,\r\n  theme: \"dark\",\r\n  showOpacity: false,\r\n};\r\n\r\nexport default settings;\r\n","import MobileDetect from 'mobile-detect'\r\nimport path from \"path\"\r\n\r\nexport const callLater = (callback,delay = 100) => {\r\n  return setTimeout(callback,delay);\r\n}\r\n\r\nexport const isMobile = () => {\r\n  var mobileDetect = new MobileDetect(window.navigator.userAgent);\r\n  return mobileDetect.mobile();\r\n}\r\n\r\nexport const isLocal = () => {\r\n  return !(/^h/.test(document.location.toString()));\r\n}\r\n\r\nexport const objectIsEmpty = (object) => {\r\n  return Object.keys(object).length === 0 && object.constructor === Object;\r\n}\r\n\r\nexport const correctUrl = (url,assetsUrl) => {\r\n\r\n  if (url) {\r\n    if (url.substr(0,1)===\"/\") {\r\n      if (!assetsUrl) {\r\n        assetsUrl=\".\";\r\n      }\r\n      url=path.join(assetsUrl,url);\r\n    }\r\n  }\r\n\r\n  return url;\r\n\r\n}\r\n\r\nexport const openLink = (link) => {\r\n  // let url=correctUrl(link)\r\n  // console.log(\"??\",url);\r\n  window.open(link,\"_blank\")\r\n}\r\n","import React, { Component } from 'react';\n\nimport mainReducer from './reducers/mainReducer'\nimport Container from './core/Container';\n\nimport DataManager from './core/DataManager';\nimport Control from './core/Control';\n\nimport { Provider } from 'react-redux'\nimport { createStore } from 'redux'\n\nimport { appInit, setStoreData, saveImages } from './actions/appActions';\n\nimport settings from './configuration/Settings';\n\nimport './css/app.css';\n\nconst Store = createStore(\n  mainReducer,\n  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()\n);\n\nclass App extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {}\n\n    this.initHandler=this.initHandler.bind(this);\n    this.resizeHandler=this.resizeHandler.bind(this);\n  }\n\n  updateLayout() {\n    let windowInnerWidth=document.documentElement.clientWidth || document.body.clientWidth || window.innerWidth;\n    let windowInnerHeight=document.documentElement.clientHeight || document.body.clientHeight || window.innerHeight;\n\n    this.setState({\n      ...this.state,\n      windowWidth:windowInnerWidth,\n      windowHeight:windowInnerHeight,\n    });\n\n  }\n\n  initHandler(event) {\n    this.updateLayout();\n  }\n\n  resizeHandler(event) {\n    this.updateLayout();\n  }\n\n  setData(data) {\n    Store.dispatch(\n      setStoreData(data)\n    );\n  }\n\n  getData(data) {\n    return Store.getState();\n  }\n\n  saveImages() {\n    Store.dispatch(\n      saveImages()\n    );\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n  }\n\n  componentDidMount() {\n    Store.dispatch(\n      appInit(settings)\n    );\n\n    window.addEventListener(\"load\",this.initHandler);\n    window.addEventListener(\"resize\",this.resizeHandler);\n\n    // window.editorApp=this;\n    // if (window.onEditorAppReady) {\n    //   window.onEditorAppReady(this);\n    // }\n\n    this.props.onInit(this);\n\n  }\n\n  render() {\n    return (\n      <Provider store={Store}>\n        <Container\n          id=\"Container\"\n          windowWidth={this.state.windowWidth}\n          windowHeight={this.state.windowHeight}\n          store={Store}\n        >\n          <DataManager\n            store={Store}\n          />\n          <Control\n            app={this}\n            store={Store}\n          />\n        </Container>\n      </Provider>\n    );\n  }\n\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nlet element=document.getElementById('editorWidget');\n\nconsole.log(element.getAttribute(\"oninit\"));\n\nReactDOM.render(\n  <React.StrictMode>\n    <App\n      id=\"editorApp\"\n      onInit={window[element.getAttribute(\"oninit\")]}\n      onImage={window[element.getAttribute(\"onimage\")]}\n      onImages={window[element.getAttribute(\"onimages\")]}\n    />\n  </React.StrictMode>,\n  element\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}